// HELPERS ================ //

// parse URL in string
String.prototype.parseURL = function() {
  return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g, function(url) {
    return '<strong>' + url + '</strong>';
  });
};

// parse twitter username in String
String.prototype.parseUsername = function(twitter) {
  return this.replace(/[@]+[A-Za-z0-9-_]+/g, function(u) {
    var username = u;
    return '<strong>' + username + '</strong>';
  });
};

// parse Twitter hashtag in String
String.prototype.parseHashtag = function(twitter) {
  return this.replace(/[#]+[A-Za-z0-9-_]+/g, function(t) {
    var tag = t.replace("#","%23")
    return '<strong>' + t + '</strong>';
    
  });
};

window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          window.oRequestAnimationFrame      ||
          window.msRequestAnimationFrame     ||
          function(/* function */ callback, /* DOMElement */ element){
            window.setTimeout(callback, 1000 / 60);
          };
})();

;
// Single Article
// =========================
$(document).ready(function() {

  if($('.single-article').length) {

    if($('#canvasloader').length) {
      
      var cl = new CanvasLoader('canvasloader');
          cl.setColor('#ceb06e');
          cl.setDiameter(20);
          cl.setDensity(34);
          cl.setRange(0.8);
          cl.setSpeed(1);
          cl.setFPS(60);
    }

    // scroll to 'share' section
    $('#share-article').on('click', function(e) {
      e.preventDefault();

      $('html, body').animate({
        scrollTop: $(".share").offset().top - $('header').height() - $('.share').height()
      }, 500);
    });

    // ajax article : previous or next
    $('body').on('click', '.single-article .nav', function(e) {
      e.preventDefault();

      var $that = $(this);

      if($that.hasClass('next')) {
        $('.anim').addClass('next');
      } else {
        $('.anim').removeClass('next');
      }

      $('.anim').addClass('show');
      setTimeout(function() {
        cl.show();
        $('#canvasloader').addClass('show');
      }, 800);

      var urlPath = $that.attr('href');

      // remove timeout once on server. only for animation.
      setTimeout(function() {
        $.get(urlPath, function(data){
          $(".content-article").html( $(data).find('.content-article') );
          history.pushState('',GLOBALS.texts.url.title, urlPath);

          $('#canvasloader').removeClass('show');

          setTimeout(function() {
            if($that.hasClass('next')) {
              $('.anim').removeClass('next show');
            }
            else {
              $('.anim').addClass('next').removeClass('show');
            }
            cl.hide();
            initSlideshows();
            initAudioPlayers();
          }, 800);
        });
      }, 500);
    });
  }
});;
var waves = [],
    inter = null,
    duration = null;

function redraw() {
  for(var i=0; i<waves.length; i++) {
    waves[i].drawBuffer();
  }
}

function initAudioPlayers() {
  $('.audio-player').each(function(i) {
    $(this).addClass('loading').find('.wave-container').attr('id', 'wave-' + i);
    var h = $(this).hasClass('bigger') ? 55 : 55;
    var wave = Object.create(WaveSurfer);

    // initialize wave sound
    wave.init({
      container: document.querySelector('#' + 'wave-' + i),
      waveColor: 'rgba(90, 90, 90, 0.5)',
      progressColor: '#c8a461',
      cursorWidth: 0,
      height: h
    });

    // load the url of the sound
    wave.load($(this).data('sound'));

    // once it's ready
    wave.on('ready', function() {
      $(wave.container).parents('.audio-player').removeClass('loading');
      if($(wave.container).parents('.audio-player').hasClass('popin-audio')) {
        $('.popin-audio .playpause').trigger('click');
      }
    });

    wave.on('finish', function() {
      wave.stop();
      $(wave.container).parents('.audio-player').removeClass('pause');
      $(wave.container).parents('.audio-player').find('.playpause').html('<i class="icon icon_video"></i>');
    });

    waves.push(wave);

    // on click on play/pause

    var $playpause = $('.playpause');
    var $fullscreen = $('.fullscreen');
    var $volume = $('.volume');


    $playpause.html('<i class="icon icon_video"></i>');
    $fullscreen.html('<i class="icon icon_fullscreen"></i>');
    if($volume.find('.icon_son').length == 0) $volume.append('<i class="icon icon_son"></i>');


    $(this).find('.playpause').on('click', function(e) {
      e.preventDefault();

      $('.playpause').not($(this)).html('<i class="icon icon_video"></i>');
      if($(this).find('i').hasClass('icon_video')){
        $(this).html('<i class="icon icon_pause"></i>');
      }else{
        $(this).html('<i class="icon icon_video"></i>');
      }

      if(inter) {
        clearInterval(inter);
      }

      $audioplayer = $(e.currentTarget).parents('.audio-player');

      // get duration
      if(!$audioplayer.hasClass('on')) {
        $audioplayer.addClass('on');

        duration = wave.getDuration();
        var minutes = parseInt(Math.floor(duration / 60));
        var seconds = parseInt(duration - minutes * 60);

        if(seconds < 10) {
          seconds = '0' + seconds;
        }
        $audioplayer.find('.duration .total').text(minutes + ':' + seconds);
      }

      // update current time
      inter = setInterval(function() {
        var curr = wave.getCurrentTime();

        var minutes = parseInt(Math.floor(curr / 60));
        var seconds = parseInt(curr - minutes * 60);

        if(seconds < 10) {
          seconds = '0' + seconds;
        }

        $audioplayer.find('.duration .curr').text(minutes + ':' + seconds);
      }, 1000);


      if(!$audioplayer.hasClass('pause')) {
        for(var i = 0; i<waves.length; i++) {
          if(waves[i].isPlaying() && waves[i].container.id != wave.container.id) {
            waves[i].pause();
          }
        }
      }
      $('.audio-player').not($audioplayer).removeClass('pause');

      // set volume and play or pause
      wave.setVolume(1);
      wave.playPause();

      $audioplayer.toggleClass('pause');
    });
  });
}


// Player Audio
// =========================
$(document).ready(function() {

  function FShandler() {

    setTimeout(function() {
      redraw();
    }, 200);
    if (document.fullscreenEnabled && document.fullscreenElement == null) {
      $('.audio-player').removeClass("full overlay-channels");
      $('.audio-player .top, .audio-player .bottom, .audio-player #channels-audio').remove();
    }
    if (document.webkitFullscreenEnabled && document.webkitFullscreenElement == null) {
      $('.audio-player').removeClass("full overlay-channels");
      $('.audio-player .top, .audio-player .bottom, .audio-player #channels-audio').remove();
    }
    if (document.mozFullScreenEnabled && document.mozFullScreenElement == null) {
      $('.audio-player').removeClass("full overlay-channels");
      $('.audio-player .top, .audio-player .bottom, .audio-player #channels-audio').remove();
    }
    if (document.msFullscreenEnabled && document.msFullscreenElement == null) {
      $('.audio-player').removeClass("full overlay-channels");
      $('.audio-player .top, .audio-player .bottom, .audio-player #channels-audio').remove();
    }
  }

  $('body').on('click', '.volume', function(e) {

    if($(this).parents('.audio-player').hasClass('full')) {
      if((e.offsetX/100) < 0.15) {
        for(var i = 0; i < waves.length; i++) {
          waves[i].toggleMute();
        }

        if(!$(this).hasClass('mute')) {
          $('.audio-player .volume span').css('width',  '0%');
        } else {
          $('.audio-player .volume span').css('width',  '100%');
        }

        $(this).toggleClass('mute');
      } else {

        var newVolume = e.offsetX / 100;

        $('.audio-player .volume span').css('width', newVolume * 100 + "%");

        for(var i = 0; i < waves.length; i++) {
          waves[i].setVolume(newVolume);
        }
      }
    } else {
      for(var i = 0; i < waves.length; i++) {
        waves[i].toggleMute();
      }

      if(!$(this).hasClass('mute')) {
        $(this).find('span').css('width',  '0%');
      } else {
        $(this).find('span').css('width',  '100%');
      }

      $(this).toggleClass('mute');
    }
  });

  $('body').on('click', '.audio-player.full .channels', function(e) {
    e.preventDefault();

    $(this).toggleClass('active');

    $('.audio-player.full').toggleClass('overlay-channels');
    $('#channels-audio').toggleClass('active');
  });

  function closeChannels() {
    $('.audio-player.full').removeClass('overlay-channels');
    $('.audio-player.full .channels').removeClass('active');
    $('#channels-audio').removeClass('active');
  }

  $('body').on('click', '.audio-player.full.overlay-channels', function(e) {
    closeChannels();
  });

  if($('.audio-player').length) {
    initAudioPlayers();
  }

  $('body').on('click', '#slider-channels-audio .channel .linkVid', function(e) {
    closeChannels();
    var ind = 0;

    if($('.audio-player').length > 1) {
      ind = $('.audio-player.full').index('.audio-player');
    }

    e.preventDefault();

    var $audioPlayer = $('.audio-player.full'),
        $newAudio = $(e.target).parent();

    var s = $newAudio.data('sound'),
        img = $newAudio.find('img').attr('src'),
        info = $newAudio.find('.info').html();

    $audioPlayer.find('.image').css('background-image', 'url(' + img + ')');
    $audioPlayer.children('.info .vCenterKid').html(info);

    waves[ind].load(s);

    // update duration
    waves[ind].on('ready', function() {
      var duration = waves[ind].getDuration();
      var minutes = parseInt(Math.floor(duration / 60));
      var seconds = parseInt(duration - minutes * 60);

      if(seconds < 10) {
        seconds = '0' + seconds;
      }
      $audioPlayer.find('.duration .total').text(minutes + ':' + seconds);
    });

  });

  // show audioplayer on fullscreen
  $('body').on('click', '.audio-player .fullscreen', function(e) {
    var i = $(this).parent().index('.audio-player'),
        wave = waves[i];

    e.preventDefault();
    var audioPlayer = $(this).parents('.audio-player')[0];

    $('.fullscreen .icon').removeClass('icon_fullscreen').addClass('icon_reverseFullScreen');
    if (document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled) {


      if($(this).parents('.audio-player').hasClass('full')) {

        $('.fullscreen .icon').removeClass('icon_reverseFullScreen').addClass('icon_fullscreen');

        setTimeout(function() {
          redraw();
        }, 200);
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
      else {
        $(audioPlayer).addClass('full');

        var info = $(audioPlayer).find('.info').html();
        $(audioPlayer).append('<div class="top"><a href="#" class="channels"><i class="icon icon_Micro"></i></a><div class="info"><div class="vCenter"><div class="vCenterKid">' + info + '</div></div></div></div>');
        $(audioPlayer).find('.top').append('<div class="buttons square"><a href="//www.facebook.com/sharer.php?u=html.festival-cannes-2016.com.ohwee.fr&t=le%20titre" onclick="javascript:window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700\');return false;" rel="nofollow" class="button facebook ajax"><i class="icon icon_facebook"></i></a><a href="#" onclick="window.open(\'https://twitter.com/intent/tweet?text=Enrages%20Polar%20Hybride\',\'\',\'width=600,height=400\')" class="button twitter"><i class="icon icon_twitter"></i></a><a href="#" class="button link"><i class="icon icon_link"></i></a><a href="#" class="button email"><i class="icon icon_lettre"></i></a></div>')
        $(audioPlayer).append('<div id="channels-audio"></div>');

        if (audioPlayer.requestFullscreen) {
          audioPlayer.requestFullscreen();
        } else if (audioPlayer.webkitRequestFullscreen) {
          audioPlayer.webkitRequestFullscreen();
        } else if (audioPlayer.mozRequestFullScreen) {
          audioPlayer.mozRequestFullScreen();
        } else if (audioPlayer.msRequestFullscreen) {
          audioPlayer.msRequestFullscreen();
        }

        $.ajax({
          type: "GET",
          dataType: "html",
          cache: false,
          url: 'channels.html' ,
          success: function(data) {
            $('#channels-audio').append(data);
            var sliderChannelsAudio = $("#slider-channels-audio").owlCarousel({
              nav: false,
              dots: false,
              smartSpeed: 500,
              center: true,
              loop: false,
              margin: 80,
              autoWidth: true,
              onInitialized: function() {
                $('#slider-channels-audio .owl-stage').css({ 'margin-left': "-343px" });

                setTimeout(function() {
                  redraw();
                }, 200);
              }
            });

            sliderChannelsAudio.owlCarousel();

          }
        });

        document.addEventListener("fullscreenchange", FShandler);
        document.addEventListener("webkitfullscreenchange", FShandler);
        document.addEventListener("mozfullscreenchange", FShandler);
        document.addEventListener("MSFullscreenChange", FShandler);
      }
    }
  });
});
;
// Contact
// =========================

$(document).ready(function() {

  if($('.contact').length) {
    // check that fields are not empty
    $('.contact input[type="text"], textarea').on('input', function() {
      var input = $(this);
      var is_name = input.val();
      if(is_name){
        input.removeClass("invalid").addClass("valid");
        $('.errors .' + input.attr('name')).remove();
      }
      else{
        input.removeClass("valid").addClass("invalid");
        $('.errors .' + input.attr('name')).remove();
        $('.errors ul').append('<li class="' + input.attr('name') + '">' + input.data('error') + '</li>');
      }

      if($('.invalid').length) {
        $('.errors').addClass('show');
      } else {
        $('.errors').removeClass('show');
      }
    });

    $('#triggerSelect').on('click', function(e) {
      e.preventDefault();

      var h = '';

      $('.select option').not('.default').each(function() {
        h += '<span>' + $(this).val() + '</span>';
      });

      $('#filters').remove();
      $('body').append('<div id="filters" class="selectOptions"><div class="vCenter"><div class="vCenterKid"></div></div><div class="close-button"></div></div>');
      $('#filters .vCenterKid').html(h);

      setTimeout(function() {
        $('#filters').addClass('show');
      }, 100);

      setTimeout(function() {
        $('#filters span').addClass('show');
      }, 400);
    });

    $('body').on('click', '.selectOptions span', function() {
      var i = parseInt($(this).index()) + 1; 
      $('select option').eq(i).prop('selected', 'selected');
      $('.select').removeClass('invalid');
    });

    // check valid email address
    $('.contact input[type="email"]').on('input', function() {
      var input=$(this);
      var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
      var is_email=re.test(input.val());
      if(is_email){
        input.removeClass("invalid").addClass("valid");
        $('.errors .' + input.attr('name')).remove();
      }
      else{
        input.removeClass("valid").addClass("invalid");
        $('.errors .' + input.attr('name')).remove();
        $('.errors ul').append('<li class="' + input.attr('name') + '">' + input.data('error') + '</li>');
      }

      if($('.invalid').length) {
        $('.errors').addClass('show');
      } else {
        $('.errors').removeClass('show');
      }
    });

    // on submit : check if there are errors in the form
    $('.contact form').on('submit', function() {
      var empty = false;

      if($('select').val() == 'default') {
        $('.select').addClass('invalid');
      } else {
        $('.select').removeClass('invalid');
      }

      $('.contact input[type="text"], .contact input[type="email"], .contact textarea').each(function() {
        if($(this).val() == '') empty = true;
      });

      if(empty) {
        $('.contact input[type="email"], .contact input[type="text"], textarea').trigger('input');
      }

      if($('.invalid').length || empty) {
        return false;
      } else {
        $('.success').show();
        $('.coords, .contact .container').hide();
        $('.contact').css('min-height', '800px');
        $('html, body').animate({
          scrollTop: 0
        }, 500);
        return false;
      }
    });
  }
  
});;
// FAQ
// =========================
$(document).ready(function() {

  if($('.faq').length) {
      //open issue
    $(".faq-container article").click(function(){
        var i;
        i = $(this).find("i.icon");
        if($(this).hasClass("faq-article-active")){

            $(this).animate({maxHeight:"100px"},100,function(){
                $(this).removeClass("faq-article-active");
                i.removeClass("icon_moins").addClass("icon_case-plus");
            });
        }else{
            $(this).addClass("faq-article-active");
            i.removeClass("icon_case-plus").addClass("icon_moins");
            $(this).animate({maxHeight:"5000px"},300);
        }
    });
    //navigation
      $(".faq-menu li").click(function(){
          var $active;
          var nameActiveSection;
          var $activeSection;
          var $newActiveSection;
          var $newActiveNav;
          var nameNewActiveSection;
          //find active section and name data
          $active = $('.faq-menu').find("li.active");
          nameActiveSection = $active.data("name");
          $activeSection = $('section[data-name='+nameActiveSection+']');
          nameNewActiveSection= $(this).data("name");
          $newActiveSection = $('section[data-name='+nameNewActiveSection+']');
          $newActiveNav = $('li[data-name='+nameNewActiveSection+']');

          if(!$(this).hasClass("active")){
              //hide active section
              $activeSection.animate({
                  top: "200px",
                  opacity:0
              },500,function(){
                  $activeSection.css({display:'none'});
                  $newActiveSection.css({display:'inline-block'});
                  $activeSection.removeClass("faq-active");
                  $newActiveSection.addClass("faq-active");
                  $('.faq-menu li').removeClass("active");
                  $newActiveNav.addClass('active');
                  $newActiveSection.animate({
                      top:0,
                      opacity:1
                  },500);
              });
          }
      });
    $(window).on('scroll', function() {
        var s = $(window).scrollTop();
        var h = $("#main").height()-900;
        var footer = $('footer').offset().top - 750;
        if($('header').hasClass('sticky')){
          if(s < h && s > 30) {
            $(".faq-menu").css({position: "fixed", top: 389});
          } else if(s > footer - 200 ){
            $(".faq-menu").css({position: "absolute",top: footer});
          } else if (s<30){
            $(".faq-menu").css({position: "fixed", top: 389});
          }
        }
    });

  }
});
;
$(document).ready(function() {

// Films
// =========================

  if($('.list-article').length){

    if($('.nav-list').length){

      $(window).on('scroll', function() {

        var s = $(window).scrollTop();
        var h = $("#main").height()-900;

        if($('.nav-movie').length){
          if(s > 343 ){
            $('.nav-list.sub-nav-list').removeClass('sticky');
            $(".sub-nav-list").css({position: "relative",top:1});
            $('.nav-movie').addClass('sticky');
            $(".nav-movie").css({position: "fixed",top:90});
            } else if (s < 343){
              $(".nav-movie").css({position: "relative",top:1});
              $(".sub-nav-list").css({position: "relative",top:1});
            }

        }else{
              if(s > 299 ){
                $('.nav-list.sub-nav-list').addClass('sticky');
                $(".nav-list.sub-nav-list").css({position: "fixed",top:90});
                $('.nav-movie').addClass('sticky');
                $(".nav-movie").css({position: "fixed",top:137});

            } else if (s < 299 ){
              $(".nav-movie").css({position: "relative",top:1});
              $(".sub-nav-list").css({position: "relative",top:1});
            }
        }



      });
    }
  }
    if($('.films-list').length){
    function ajaxEvent(){
      $('.films-list .sub-nav-list a').on('click',function(e){
        e.preventDefault();
        if($(this).is(':not(.active)')) {
          var urlPath = $(this).attr('href');
          $.get(urlPath, function(data){

            $( ".container-list" ).html( $(data).find('.container-list') );
            $( ".bandeau-list-footer" ).html( $(data).find('.bandeau-list-footer').html() );
            $( ".bandeau-head" ).html( $(data).find('.bandeau-head') );

            history.pushState('',GLOBALS.texts.url.title, urlPath);
            $grid = $('#gridFilmSelection').imagesLoaded(function() {
              $grid.isotope({
                layoutMode: 'packery',
                itemSelector: '.item'
              });
            });
            initAudioPlayers();
            ajaxEvent();
          });
          $('.films-list .sub-nav-list').find('a.active').removeClass('active');
          $(this).addClass('active');
        }
      });
        initSlideshows();
    }
    ajaxEvent();
  }
});
;
// Filters
// =========================

function filter() {
  var id = $('#filters').data('id');
  var filters = [];

  $('.filter').each(function() {
    var $that = $(this);
    var a = $that.find('.select span.active').data('filter');

    if(a == 'all') {
      $('.content-news .slideshow').show();
      return;
    }

    var obj = {'filter': $that.attr('id'), 'value': a};

    filters.push(obj);
  });

  var exp1 = '',
      exp2 = '';

  for(var i=0; i<filters.length; i++) {
    exp1 += '[data-' + filters[i].filter + ']';
    exp2 += '[data-' + filters[i].filter + '="' + filters[i].value + '"]';
  }

  if($('#filteredArticles').length) {
    $('#filteredArticles').remove();
  }

  if(filters.length != 0) {
    $('*' + exp1).hide();
    $('*' + exp2).show();

    if($('.articles').length != 0) {
      $('#articles-wrapper').prepend('<div class="articles center" id="filteredArticles"></div>');

      $('.articles:not(.nextDay) article').each(function() {
        if($(this).css('display') == 'block') {
          $('#filteredArticles').append($(this).clone().removeClass('double'));
          $(this).hide();
        }
      });

      if($('#format .select .active').text() == "Photo") {
        $('.content-news .slideshow').show();
      } else {
        $('.content-news .slideshow').hide();
      }

      $('.articles.nextDay article').show();
    }
  } else {
    $('*[data-' + id + ']').show();
  }
}

$(document).ready(function() {

  // on click on a filter
  $('.filters .select span').on('click', function() {
    var h = $(this).parent().html();

    $('#filters').remove();
    $('body').append('<div id="filters"><div class="vCenter"><div class="vCenterKid"></div></div><div class="close-button"><i class="icon icon_close"></i></div></div>');
    $('#filters .vCenterKid').html(h);
    $('#filters').attr('data-id', $(this).parents('.filter').attr('id'));

    setTimeout(function() {
      $('#filters').addClass('show');
    }, 100);

    setTimeout(function() {
      $('#filters span').addClass('show');
    }, 400);
  });

  // close filters
  $('body').on('click', '#filters', function() {
    $('#filters').removeClass('show');
    setTimeout(function() {
      $('#filters').remove();
    }, 700);
  });

  // filter data on page
  $('body').on('click', '#filters span', function() {

      var id = $('#filters').data('id'),
          i = $(this).index();

      $('#' + id + ' .select span').removeClass('active');
      $('#' + id + ' .select span').eq(i).addClass('active');

      filter();
  });

});
;
// Google map 

//page participate 

function initialize() {
    var myLatLng = new google.maps.LatLng(43.5477427, 7.0300728);
            var mapOptions = {
                center: myLatLng,
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.PLAN,
                scrollwheel: false,
                draggable: false,
                panControl: false,
                zoomControl: true,
                mapTypeControl: false,
                scaleControl: false,
                streetViewControl: true,
                overviewMapControl: true,
                rotateControl: true,
            }
            var map = new google.maps.Map(document.getElementById("google-map"), mapOptions);
    
    var marker = new google.maps.Marker({
      position: myLatLng,
      map: map,
      title: GLOBALS.texts.googleMap.title
  });

}

$(document).ready(function() {

    if($('#google-map').length) {
        google.maps.event.addDomListener(window, 'load', initialize);
    }
});;
// All Photos
// =========================

var itemReveal = Isotope.Item.prototype.reveal;
Isotope.Item.prototype.reveal = function () {
  itemReveal.apply(this, arguments);
  $(this.element).removeClass('isotope-hidden');
};

var itemHide = Isotope.Item.prototype.hide;
Isotope.Item.prototype.hide = function () {
  itemHide.apply(this, arguments);
  $(this.element).addClass('isotope-hidden');
};

function resizeGrid() {
  var result = document.getElementById('result');
  if ("matchMedia" in window) {
    setGrid(false, $('#gridAudios'), true);
  }
}

function setGrid(grid, dom, init){
  var $img            = $(dom).find('.item img'),
      pourcentage     = 0.30,
      nbImgAAgrandir  = $img.length * pourcentage,
      i               = 0,
      nbRamdom        = [],
      x               = 1,
      j               = 0,
      max             = 0,
      min             = 0,
      nbImage         = $img.length;

  function buildGrid() {
    $($img).closest('div.item').removeClass('w2');
    if (window.matchMedia("(max-width: 1599px)").matches) {
      while (i < $img.length) {
        if (j < 11) {
          if (j == 0 || j == 3) {
            $($img[i]).closest('div.item').addClass('w2');
          }
          j++;
        }
        if (j == 10) {
          j = 0;
        }
        i++;
      }
    } else if (window.matchMedia("(max-width: 1919px)").matches) {

      while (i < $img.length) {
        if (j < 31) {
          if (j == 0 || j == 3 || j == 12 || j == 17 || j == 25) {
            $($img[i]).closest('div.item').addClass('w2');
          }
          j++;
        }
        if (j == 30) {
          j = 0;
        }
        i++;
      }

    } else if (window.matchMedia("(min-width: 1920px)").matches) {
      while (i < $img.length) {
        if (j < 16) {
          if (j == 0 || j == 5 || j == 15) {
            $($img[i]).closest('div.item').addClass('w2');

          }
          j++;
        }
        if (j == 10) {
          j = 0;
        }
        i++;
      }
    }
  }
  if (!init) {
    if ($('#gridEvent').length) {
      $data = $(dom).find('.item');
    } else {
      $data = $(dom);
    }
    grid.append($data).isotope('appended', $data);
    grid.imagesLoaded().progress(function () {
      grid.isotope('layout');
    });
  }
  buildGrid();
}

$(document).ready(function () {

function setImages(grid, dom, init){
    var $img            = $(dom).find('.item:not(.portrait) img'),
        pourcentage     = 0.50,
        nbImgAAgrandir  = $img.length * pourcentage,
        i               = 0,
        nbRamdom        = [],
        x               = 1,
        max             = 0,
        min             = 0,
        nbImage         = $img.length;

    while (x < nbImgAAgrandir) {
      while (nbImgAAgrandir > nbRamdom.length) {
        max = nbImage * pourcentage * x;
        min = nbImage * pourcentage * (x - 1);
        nbAlea = Math.floor(Math.random() * (max - min) + min);
        nbRamdom[i] = nbAlea;
        $($img[nbRamdom[i]]).closest('div.item').addClass('w2');
        i++;
        x++;
      }
    }

    if (!init) {
      grid.append($(dom)).isotope('appended', $(dom));
      grid.imagesLoaded(function () {
        setTimeout(function() {grid.isotope('layout');}, 500);
      });
    }
  }

  function closePopinAudio() {
    $('.popin-audio, .ov').removeClass('show');

    $('.popin-audio').find('.wave-container').empty().removeAttr('id');
    for (var i = 0; i < waves.length; i++) {
      if (waves[i].isPlaying()) {
        waves[i].stop();
      }
    }
    $('.popin-audio').removeClass('pause audio-player');
    waves = [];

    if(inter) {
      clearInterval(inter);
    }
  }

  if ($('.grid').length) {

    if ($('#gridPhotos').length) {

      var $container = $('#gridPhotos'),
        $grid;

      $grid = $('#gridPhotos').imagesLoaded(function () {

        setImages($grid, $('#gridPhotos'), false);
        $grid.isotope({
          itemSelector: '.item',
          percentPosition: true,
          layoutMode: 'packery',
          packery: {
            columnWidth: '.grid-sizer'
          }
        });

        if($('.all-photos').length) {
          setTimeout(function() {
            $grid.isotope({ sortBy : 'original-order' });
          }, 500);
        }
      });
    }

    if ($('.all-photos').length) {
      var slideshow = $('#gridPhotos').Chocolat({
        imageSize: 'cover',
        fullScreen: false
      }).data('chocolat');

      slideshows.push(slideshow);
    }

    if ($('#gridWebtv').length) {
      $grid = $('#gridWebtv').imagesLoaded(function () {

        $grid.isotope({
          layoutMode: 'packery',
          itemSelector: '.item'
        });
      });
    }

    if ($('#gridJurys').length) {
      $grid = $('#gridJurys').imagesLoaded(function () {

        $grid.isotope({
          layoutMode: 'packery',
          itemSelector: '.item'
        });
      });
    }
    if ($('#gridFilmSelection').length) {
      $grid = $('#gridFilmSelection').imagesLoaded(function () {

        $grid.isotope({
          layoutMode: 'packery',
          itemSelector: '.item'
        });
      });
    }

    if ($('#gridAudios').length) {

      $('.ov').on('click', function (e) {
        e.preventDefault();
        closePopinAudio();
      });

      var $container = $('#gridAudios'),
        $grid;

      $grid = $('#gridAudios').imagesLoaded(function () {
        // init Isotope after all images have loaded
        setGrid($grid, $('#gridAudios'), true);
        $grid.isotope({
          itemSelector: '.item',
          percentPosition: true,
          layoutMode: 'packery',
          packery: {
            columnWidth: '.grid-sizer'
          }
        });

        $grid.isotope('layout');

        if ($('#gridAudios').data('type') == 'audios') {
          $('body').on('click', '#gridAudios .item', function (e) {

            var s = $(e.target).data('sound'),
              img = $(e.target).find('img').attr('src'),
              category = $(e.target).find('.category').text(),
              date = $(e.target).find('.date').text(),
              hour = $(e.target).find('.hour').text(),
              text = $(e.target).find('p').text(),
              $popinAudio = $('.popin-audio');

            $popinAudio.attr('data-sound', s);
            $popinAudio.find('.image').css('background-image', 'url(' + img + ')'); // TODO URL A VERIFIER besoin du json ? //
            $popinAudio.find('.category').text(category);
            $popinAudio.find('.date').text(date);
            $popinAudio.find('.hour').text(hour);
            $popinAudio.find('p').text(text);
            $popinAudio.addClass('audio-player show loading');
            waves = [];
            $('.audio-player .playpause').off('click');
            initAudioPlayers();
            $('.ov').addClass('show');
          });
        }
      });

      $('#gridAudios').infinitescroll({
        navSelector: "#next:last",
        nextSelector: "#next:last",
        itemSelector: "#gridAudios",
        debug: false,
        dataType: 'html',
        path: function (index) {
          //TODO dev// 
          return $('#gridAudios').data('type') + index + ".html";
        }
      }, function (newElements, data, url) {
        setGrid($grid, newElements, false);

      });
    }

    var filterValues = "";

    // filters
    $('body').on('click', '#filters span', function () {

      filterValues = "";

      $('.filter .select .active').each(function () {
        if ($(this).data('filter') != 'all') {
          filterValues += '.' + $(this).data('filter');
        }
      });

      $container.isotope({
        filter: filterValues
      });

      // if($('.all-photos').length) {
      //   setTimeout(function() {
      //     for(var i=0; i<slideshows.length; i++) {
      //       slideshows[i].api().destroy();
      //     }

      //     slideshows = [];
      //     $('.chocolat-wrapper').remove();
      //     initSlideshows();
      //   }, 1500);
      // }
    });
  }

});;
// 1. Jurys
// 2. Artist Page
// =========================

$(document).ready(function() {

  //1. Jury
  
  if($('.jurys-list').length){
  $('.jurys-list .sub-nav-list a').on('click',function(e){
      //:not(.active)
      e.preventDefault();

      if($(this).is(':not(.active)')) {
        var urlPath = $(this).attr('href');
        
//        $.get($(this).data('url'), function(data){
        $.get(urlPath, function(data){
            $( ".container-jurys" ).html( $(data).find('.container-jurys') );
            $('.bandeau-head').html( $(data).find('.bandeau-head') );
            $('.bandeau-list-footer').html( $(data).find('.bandeau-list-footer').html() );
          
            history.pushState('',GLOBALS.texts.url.title, urlPath);
             $grid = $('#gridJurys').imagesLoaded(function() {
                $grid.isotope({
                  layoutMode: 'packery',
                  itemSelector: '.item'
                });
             });
        });
        $('.jurys-list .sub-nav-list').find('a.active').removeClass('active');
        $(this).addClass('active');
      }
    });
    
    //Scroll
      $(window).on('scroll', function() {
        
        var s = $(window).scrollTop();
        var h = $("#main").height()-900;

      if(s > 470 ){
        $('.sub-nav-list').addClass('sticky');
        $(".sub-nav-list").css({position: "fixed",top:90});
      } else if (s < 470){
        $(".sub-nav-list").css({position: "relative",top:1});
      }
      });
  }
  
  //2. Artist
  
  if($('.artist').length){
        $(window).on('scroll', function() {

      var s = $(window).scrollTop();
      var h = $("#main").height()-900;

      
    if(s > 2780 ){
        $('.single-article .nav.prev, .single-article .nav.next').css({'opacity':'0'});
    } else if (s < 2780){
        $('.single-article .nav.prev, .single-article .nav.next').css({'opacity':'1'});
    }
    });
  }
});
;
// Main menu
// =========================

var displayed = false,
    graphRendered = false;

$(document).ready(function() {
    
  // overlay on main menu : show submenu and overlay
  if(!$('body').hasClass('mob')) {
    $('.main>li, .user>li').hover(function() {
      $('#main, footer').addClass('overlay');
      $('.main>li').not($(this)).addClass('fade');
    }, function() {
      if(!$('#selection').hasClass('open') && !$('#searchContainer').hasClass('open')) {
        $('#main, footer').removeClass('overlay');
      }
      $('.main li').removeClass('fade');
    });
  }

  $('.main>li>a, .user>li>a').on('click', function(e) {
    if($('body').hasClass('mob')) {
      if($(this).parent().find('ul').length != 0) {
        e.preventDefault();
        $('#main, footer').addClass('overlay');
        $('.main>li').not($(this).parent()).addClass('fade');
        return false;
      }
    }
  });

});;
var playmovie;

// Single Movie
// =========================
$(document).ready(function() {

  if($('.single-movie').length) {

    var cl = new CanvasLoader('canvasloader');
        cl.setColor('#ceb06e');
        cl.setDiameter(20);
        cl.setDensity(34);
        cl.setRange(0.8);
        cl.setSpeed(1);
        cl.setFPS(60);

    function setActiveMovieVideos() {
      $('#slider-movie-videos .owl-item').removeClass('center');
      $('#slider-movie-videos .owl-item.active').first().addClass('center');
    }

    function initSliders() {
      // init slider
      var sliderMovieVideos = $("#slider-movie-videos").owlCarousel({
        nav: false,
        dots: false,
        smartSpeed: 500,
        loop: false,
        margin: 50,
        autoWidth: true,
        dragEndSpeed: 600,
        responsive:{
          0:{
            items: 3
          },
          1675: {
            items: 4
          }
        },
        onInitialized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-movie-videos .owl-stage').css({ 'margin-left': m });
          setActiveMovieVideos();
        },
        onResized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-movie-videos .owl-stage').css({ 'margin-left': m });
        },
        onTranslated: function() {
          setActiveMovieVideos();
        }
      });

      sliderMovieVideos.owlCarousel();

      // slider competitions
      var sliderCompetition = $("#slider-competition").owlCarousel({
        nav: false,
        dots: false,
        smartSpeed: 500,
        loop: false,
        margin: 50,
        autoWidth: true,
        dragEndSpeed: 600,
        responsive:{
          0:{
            items: 4
          },
          1675: {
            items: 5
          }
        },
        onInitialized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-competition .owl-stage').css({ 'margin-left': m });
        },
        onResized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-competition .owl-stage').css({ 'margin-left': m });
        }
      });

      sliderCompetition.owlCarousel();
    }
    
    initSliders();

    // go to item
    $('body').on('click', '#slider-movie-videos .owl-item', function(e) {
      sliderMovieVideos.trigger('to.owl.carousel', [$(this).index(), 400, true]);
    });

    // gallery slideshow
    $('body').on('click', '.gallery .thumbs a', function(e) {
      e.preventDefault();
      var i = $(this).index(),
          cap = $(this).data('caption');

      $('.gallery .img img').removeClass('active');
      $('.gallery .img img').eq(i).addClass('active');

      $('.gallery .thumbs a').removeClass('active');
      $(this).addClass('active');

      $('.gallery .caption').text(cap);
    });

    // anchors menu
    $('body').on('click', '#nav-movie ul a', function (e) {
      e.preventDefault();

      $('#nav-movie ul a').removeClass('active');
      $(this).addClass('active');

      var $el = $(this)
        , id = $el.attr('href').substr(1);
     
      var posT = $('*[data-section="' + id + '"]').offset().top - $('#nav-movie').height() - $('header').height();

      if(!$('#nav-movie').hasClass('sticky')) {
        posT -= 32;
      }

      $('html, body').animate({
        scrollTop: posT
      }, 500);
    });

    $('body').on('click', '#slider-competition .owl-item', function(e) {
      sliderCompetition.trigger('to.owl.carousel', [$(this).index(), 400, true]);
    });

    // show and play trailer
    $('body').on('click', '.poster .picto', function(e) {
      e.preventDefault();

      $('html, body').animate({
        scrollTop: 0
      }, 300, function() {
        $('#video-movie').playerInit('video-movie', false, fak):
        $('.main-image, .poster, .info-film, .nav').addClass('trailer');
        $('.main-image').data('height', $('.main-image').height()).height($(window).height() - 91).css('padding-top', '91px');
        setTimeout(function() {
          $('header').addClass('sticky');
          $('body').css('padding-top', 0);
        }, 800);
        
      });
    });

    // previous and next over
    $('body').on('mouseover', '.single-movie .nav', function(e) {
      if($(this).hasClass('prev')) {
        $('.prevmovie').addClass('show');
      } else {
        $('.nextmovie').addClass('show');
      }
    });

    $('body').on('click', '.single-movie .prevmovie', function(e) {
      $('.single-movie .nav.prev').trigger('click');
    });

    $('body').on('click', '.single-movie .nextmovie', function(e) {
      $('.single-movie .nav.next').trigger('click');
    });

    // previous and next over
    $('body').on('mouseover', '.single-movie .prevmovie', function(e) {
      $('.single-movie .nav.prev').addClass('over');
    });
    $('body').on('mouseover', '.single-movie .nextmovie', function(e) {
      $('.single-movie .nav.next').addClass('over');
    });

    $('body').on('mouseover', '.main-image, .container, .videos, div.press, .competition', function(e) {
      $('.prevmovie, .nextmovie').removeClass('show');
      $('.single-movie .nav').removeClass('over');
    });

    // previous and next
    $('body').on('click', '.single-movie .nav', function(e) {
      e.preventDefault();

      var $that = $(this);

      if($that.hasClass('next')) {
        $('.anim').addClass('next');
      } else {
        $('.anim').removeClass('next');
      }

      $('.anim').addClass('show');
      setTimeout(function() {
        cl.show();
        $('#canvasloader').addClass('show');
      }, 800);

      var urlPath = $that.attr('href');

      // remove timeout once on server. only for animation.

      setTimeout(function() {
        $('html, body').animate({
          scrollTop: 0
        }, 0);
        $.get(urlPath, function(data){
          $(".content-movie").html( $(data).find('.content-movie') );
          history.pushState('',GLOBALS.texts.url.title, urlPath);

          $('#canvasloader').removeClass('show');

          setTimeout(function() {
            if($that.hasClass('next')) {
              $('.anim').removeClass('next show');
            }
            else {
              $('.anim').addClass('next').removeClass('show');
            }
            cl.hide();
            initSliders();
            initSlideshows();
            initAudioPlayers();
          }, 800);
        });
      }, 2000);
    });

  }

});;
$(document).ready(function() {

  if($('.home').length) {

  // News
  // =========================

  var cl = new CanvasLoader('canvasloader');
    cl.setColor('#ceb06e');
    cl.setDiameter(20);
    cl.setDensity(34);
    cl.setRange(0.8);
    cl.setSpeed(1);
    cl.setFPS(60);

  // Change date

  $('#timeline a').on('click', function(e) {
    e.preventDefault();

    if($(this).hasClass('active') || $(this).hasClass('disabled')) {
      return false;
    }

    $('#timeline a').removeClass('active');
    $(this).addClass('active');

    $('#articles-wrapper').addClass('loading');

    $('#shd').removeClass('show');
    $('.read-more').html(GLOBALS.texts.readMore.more).removeClass('prevDay');

    $('html, body').animate({
      scrollTop: $("#news").offset().top - 50
    }, 500);

    setTimeout(function() {
      cl.show();
      $('#canvasloader').addClass('show');
    }, 800);

    // todo: remove timeout
    setTimeout(function() {
      $.ajax({
        type: "GET",
        dataType: "html",
        cache: false,
        url: GLOBALS.urls.newsUrl ,
        success: function(data) {
          $('#canvasloader').removeClass('show');
          $('#articles-wrapper').html(data);

          setTimeout(function() {
            cl.hide();
            $('#articles-wrapper').removeClass('loading');
          }, 500);
          filter();

          initSlideshows();
        }
      });
    }, 2200);
    
  });

  
  $('.read-more').hover(function() {
    if(!$(this).hasClass('prevDay')) {
      $('#shdMore').addClass('show');
    }
  }, function() {
    $('#shdMore').removeClass('show');
  });

  // load more
  $('.read-more').on('click', function(e) {
    e.preventDefault();

    $('#timeline').removeClass('bottom');
    // load previous day
    if($(this).hasClass('prevDay')) {
      $('#shd').removeClass('show');
      $('.read-more').html( GLOBALS.texts.readMore.more ).removeClass('prevDay');
      $('#articles-wrapper').addClass('loading');
      
      $('html, body').animate({
        scrollTop: $("#news").offset().top - 50
      }, 1000);

      var i = $('#timeline a.active').index();
      $('#timeline a').removeClass('active');
      $('#timeline a').eq(i).next().addClass('active');

      setTimeout(function() {
        cl.show();
        $('#canvasloader').addClass('show');
      }, 800);

      // todo: remove timeout
      setTimeout(function() {
        $.ajax({
          type: "GET",
          dataType: "html",
          cache: false,
          url: GLOBALS.urls.newsUrl ,
          success: function(data) {
            $('#canvasloader').removeClass('show');

            setTimeout(function() {
              cl.hide();
              $('#articles-wrapper').removeClass('loading');
            }, 500);

            $('#articles-wrapper').html(data);

            filter();

            initSlideshows();
            $(window).trigger('resize');
          }
        });
      }, 1200);
    } else {
      $('#shdMore').removeClass('show');
      $.ajax({
        type: "GET",
        dataType: "html",
        cache: false,
        url: GLOBALS.urls.newsUrlNext , // TODO a revoir //
        success: function(data) {
          $('#articles-wrapper').css('max-height', $('#articles-wrapper').height()).append(data);
          $('#articles-wrapper').css('max-height', $('#articles-wrapper').prop('scrollHeight'));
          filter();
          $('.read-more').html(GLOBALS.texts.readMore.nextDay).addClass('prevDay');

          $('html, body').animate({
            scrollTop: $(".articles.center").offset().top + $(".articles.center").height() - 70
          }, 500);

          setTimeout(function() {
            $('#shd').addClass('show');
            $(window).trigger('resize');
          }, 500);
        }
      });
    }
      
  });

  }

});;
// Newsletter
// =========================

$(document).ready(function() {

  $('.newsletter #email').on('focus', function() {
    if($(this).val() == GLOBALS.texts.newsletter.errorsNotValide || $(this).val() == GLOBALS.texts.newsletter.errorsMailEmpty) {
      $(this).val('');
      $(this).removeClass('error');
    }
  });

  // on submit : check if there are errors in the form
  $('.newsletter form').on('submit', function() {

    var input = $('.newsletter #email');
    var empty = false;

    if($('#email').val() == '') {
      empty = true;
      input.addClass("error").val("GLOBALS.texts.newsletter.errorsMailEmpty");
    } else {

      var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
      var is_email=re.test(input.val());
      if(is_email){
        input.removeClass("error");
      }
      else {
        input.addClass("error").val(GLOBALS.texts.newsletter.errorsNotValide);
      }
    }

    if($('.newsletter .error').length || empty) {
      return false;
    } else {
      // ajax call newsletter

      // show confirmation 
      $('.newsletter form').addClass('hide');
      $('#confirmation span').html($('#email').val());
      $('#confirmation').addClass('show');

      return false;
    }
  });
});;
// Palmares
// =========================

$(document).ready(function() {

  if($('.palmares-list').length){
    
      $('.palmares-list .sub-nav-list a').on('click',function(e){
      //:not(.active)
      e.preventDefault();

      if($(this).is(':not(.active)')) {
        var urlPath = $(this).attr('href');
  //        $.get($(this).data('url'), function(data){
        $.get(urlPath, function(data){
          $( ".container-list" ).html( $(data).find('.container-list').html());
          $('.bandeau-head').html( $(data).find('.bandeau-head') );
          $('.push-footer').html( $(data).find('.push-footer').html() );
          history.pushState('',GLOBALS.texts.url.title, urlPath);
        });
        $('.palmares-list .sub-nav-list').find('a.active').removeClass('active');
        $(this).addClass('active');
      }
    });
        //Scroll
      $(window).on('scroll', function() {
        
        var s = $(window).scrollTop();
        var h = $("#main").height()-900;

      if(s > 470 ){
        $('.sub-nav-list').addClass('sticky');
        $(".sub-nav-list").css({position: "fixed",top:90});
      } else if (s < 470){
        $(".sub-nav-list").css({position: "relative",top:1});
      }
      });
  }

});;
// Participate
// =========================
$(document).ready(function() {


  if($('.participate').length) {

      //open issue
    if(!$('.content-contractor').length){
      $(".contain-section h3, .contain-section .accordion").click(function(){
          var i;
        var $this = $(this).closest('.contain-section');
          i = $this.find("i.accordion");
          if($this.hasClass("participate-active")){

              $this.animate({maxHeight:"100px"},100,function(){
                  $this.removeClass("participate-active");
                  i.removeClass("icon_moins").addClass("icon_case-plus");
              });
          }else{
              $this.addClass("participate-active");
              i.removeClass("icon_case-plus").addClass("icon_moins");
              $this.animate({maxHeight:"5000px"},300);
          }
      });
    }
  }
});
;
$(document).ready(function() {
  if($('#praticalguide').length) {
    //click nav

    $(".contain-title-pg, .accordion").click(function(){
      var $parent = $(this).closest('section');
      if(!$parent.hasClass('active')){
          $parent.animate({maxHeight:"3000px"},100,function(){
            $parent.addClass('active');
            var  element = $parent.find('.icon_case-plus');
            element.removeClass('icon_case-plus').addClass('icon_moins');
          });
      }else{
          $parent.animate({maxHeight:"95px"},100,function(){
            var  element = $parent.find('.icon_moins');
            $parent.removeClass('active');
            element.removeClass('icon_moins').addClass('icon_case-plus');
          });
      }
    });
    }
});
;
$(document).ready(function() {

  if($('.home').length) {

  // Prefooter
  // =========================

    // show image on mouseover
    $('#prefooter ul a').on('mouseover', function(e) {
      e.preventDefault();

      $('.imgSlide, #prefooter a').removeClass('active');
      var i = $(this).parent().index();

      $(this).addClass('active');
      sliderPrefooter.trigger('to.owl.carousel', [i, 900, true]);
    });

    var sliderPrefooter = $("#slider-prefooter").owlCarousel({
      nav: false,
      dots: false,
      smartSpeed: 500,
      center: true,
      loop: false,
      margin: 0,
      items: 1,
      touchDrag: false,
      mouseDrag: false
    });

    sliderPrefooter.owlCarousel();
  }

});;
$(document).ready(function() {

  // Prehome
  // =========================

  if($('.home').length) {

    // if cookie doesn't exist
    if(!$.cookie('prehome')) {
      // set height and display prehome
      $('#prehome-container').height($(window).height());
      $('#prehome').addClass('show');

      // scroll and remove prehome
      setTimeout(function() {
        $('html, body').animate({
          scrollTop: $("header").offset().top
        }, 800, function() {
          $('body,html').scrollTop(0);
          $('#prehome-container').remove();
        });
      }, 3000);
      $.cookie('prehome', '1', { expires: 7 });
    } else {
      // remove prehome, we don't need to see it
      $('#prehome-container').remove();
    }
  }

});;
$(document).ready(function () {

  // init array of events
  var events = [];

  // get local storage
  var agenda = localStorage.getItem('agenda_press');

  // if local storage, get the events
  if (agenda != null) {
    events = JSON.parse(agenda);
  }

  // if cookie press
  if ($.cookie('press')) {
    $('.lock').removeClass('lock');
    $('.locked').remove();
    $('.icon_cadenas').removeClass('icon_cadenas').addClass('icon_telecharger');
  }

  function validateForm($this) {
    var v = $this.find('input[type="password"]').val();
    // todo on server : security check password.

    if (v == "test") {
      $.cookie('press', '1', {
        expires: 365
      });


      $('.lock').removeClass('lock').addClass('connected');
      $('.locked .vCenterKid').html('<p class="access">' + GLOBALS.texts.popin.acces + '</p>');
      $('.locked form').remove();

      $('#popin-press').removeClass('visible-popin');
      $("#main").removeClass('overlay-popin');
      $('footer').removeClass('overlay');

      $('.icon_cadenas').removeClass('icon_cadenas').addClass('icon_telecharger');

      popinInit();

    } else {
      $this.addClass('error');
    }
  }

  $('.locked form').on('submit', function (e) {
    e.preventDefault();
    $this = $(this);
    validateForm($this);
  });

  $('#popin-press form').on('submit', function (e) {
    e.preventDefault();
    $this = $(this);
    validateForm($this);
  });

  $('.service-presse').on('click', function (e) {
    e.preventDefault();

    $('html, body').animate({
      scrollTop: $('.contact-press').offset().top - 230
    }, 500);
  });

  var count = 0;

  $('#timeline .arrow').on('click', function (e) {
    e.preventDefault();

    $('#timeline .arrow').removeClass('hide');


    if ($(this).hasClass('left')) {
      if (count < $('#timeline a.active').index()) {
        $('#timeline a.active').addClass('hideB');
      } else {
        $('#timeline a.active').removeClass('hideB');
      }
      $('#timeline').removeClass('max');

      var $v = $('#timeline a').eq(count);
      if ($v.prev().length) {
        var p = -(($v.width() + 1) * (count - 1));
        $('.timeline-container').css({
          '-webkit-transform': 'translateX(' + p + 'px)',
          '-moz-transform': 'translateX(' + p + 'px)',
          '-o-transform': 'translateX(' + p + 'px)',
          '-ms-transform': 'translateX(' + p + 'px)',
          'transform': 'translateX(' + p + 'px)'
        });
        count--;
      }

      if ($v.prev().prev().length == 0) {
        $(this).addClass('hide');
      }
    } else {
      var $v = $('#timeline a').eq(count);
      var p = -(($v.width() + 1) * (count + 1));
      var max = 263;
      if (count >= $('#timeline a.active').index()) {
        $('#timeline a.active').addClass('hideB');
      } else {
        $('#timeline a.active').removeClass('hideB');
      }
      if (!$('#timeline').hasClass('max')) {
        count++;
      }

      if (-p > max) {
        p = -max;
        $('#timeline').addClass('max');
        $(this).addClass('hide');
      } else {
        $('#timeline').removeClass('max');
      }
      $('.timeline-container').css({
        '-webkit-transform': 'translateX(' + p + 'px)',
        '-moz-transform': 'translateX(' + p + 'px)',
        '-o-transform': 'translateX(' + p + 'px)',
        '-ms-transform': 'translateX(' + p + 'px)',
        'transform': 'translateX(' + p + 'px)'
      });
    }
  });

  function openPopinEvent(url) {
    $.ajax({
      type: "GET",
      dataType: "html",
      cache: false,
      url: url,
      success: function (data) {
        $('.popin-event').remove();
        // display the html
        $('#calendar-programmation').append(data);

        // init the events
        initDraggable();

        // init the slider of movies
        var sliderFilms = $(".films").owlCarousel({
          nav: true,
          dots: false,
          smartSpeed: 500,
          fluidSpeed: 500,
          center: true,
          loop: false,
          margin: 20,
          autoWidth: true,
          mouseDrag: false,
          onInitialized: function () {
            $('<span class="pagination"><strong>1</strong>/' + $('.films .owl-item').length + '</span>').insertAfter($('.films .owl-prev'));
          },
          onTranslated: function () {
            var i = parseInt($('.films .center').index()) + 1;
            $('.pagination strong').text(i);
          }
        });

        // test if events are already store in local storage
        if (events.length != 0) {
          $('.events-container .fc-event').each(function () {
            var id = $(this).data('id'),
              $this = $(this);

            for (var i = 0; i < events.length; i++) {
              if (id == events[i].id) {
                $this.parent().addClass('delete');
                $this.parent().find('.button').removeClass('add').text(GLOBALS.texts.agenda.delete);
              }
            }
          });
        }

        $('html, body').animate({
          scrollTop: $(".press .programmation").offset().top - 91
        }, 500);

        // show popin
        setTimeout(function () {
          $('.popin-event').addClass('show');
        }, 100);

      }
    });
  }

  $('.subnav, .subnav icon').hover(function () {
    $('.button.list').addClass('show');
  });

  $('.buttons').mouseout(function () {
    $('.button.list').removeClass('show');
  });

  $('.button.list').mouseover(function () {
    $('.button.list').addClass('show');
  });

  $('.subnav').on('click', function (e) {
    e.preventDefault();
  });

  if ($('#mycalendar').length) {

    var maxDate = '22';
    var minDate = '11';

    // full width calendar (page 'my calendar')
    if ($('#calendar').hasClass('fullwidth')) {
      var lang = GLOBALS.locale;
      $('#mycalendar').fullCalendar({
        lang: lang,
        defaultDate: '2016-05-11', // TODO A REVOIR //
        header: {
          left: 'prev',
          center: 'title',
          right: 'next'
        },
        views: {
          agendaFive: {
            type: 'agenda',
            duration: {
              days: 6
            },
            buttonText: '5 day',
          },
          agendaFour: {
            type: 'agenda',
            duration: {
              days: 5
            },
            buttonText: '4 day'
          },
          agendaThree: {
            type: 'agenda',
            duration: {
              days: 4
            },
            buttonText: '3 day'
          },
        },
        firstDay: 3,
        defaultView: 'agendaWeek',
        columnFormat: {
          week: 'dddd D MMM',
          agenda: 'dddd D MMM'
        },
        minTime: "08:00:00",
        maxTime: "28:00:00",
        allDaySlot: false,
        events: events,
        slotEventOverlap: false,
        slotLabelFormat: typeof GLOBALS.calendar.labelFormat[GLOBALS.locale] !== "undefined" ? GLOBALS.calendar.labelFormat[GLOBALS.locale] : GLOBALS.calendar.labelFormat.default,
        eventAfterRender: function (event, element, view) {
          if (event.duration / 60 < 2) {
            $(element).addClass('one-hour');
          }
          var dur = event.duration / 60 + 'H';
          var c = event.eventColor;
          $(element).css('width', 'auto');
          $(element).css('height','auto');
          $(element).empty();
          $(element).addClass(event.eventPictogram);
          $(element).attr('data-id', event.id);
          $(element).empty();

          if (c == '#000') {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-seance-presse"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#9b9b9b") {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-seance"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#a68851") {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-conference"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#fff") {
            $(element).append('<span class="category" style="background-color:' + c + ';color:#000;"><i class="icon icon_evt-personnel"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close" style="color:#000;"></i></a></span>');
          } else {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_espace-presse"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          }
          if (c == "#fff") {
            $(element).append('<div class="info"><div class="txt" style="margin-left:10px"><span>' + event.title + '</span></div></div>');
          }else{
            $(element).append('<div class="info"><img src="' + event.picture + '" /><div class="txt"><span>' + event.title + '</span><strong>' + event.author + '</strong></div></div>');
          }

          if (c == "#fff") {
            $(element).append('<div class="bottom"><span class="duration">' + dur + '</span> - <span class="ven">' + event.room.toUpperCase() + '</span></div>');
          }else{
            $(element).append('<div class="bottom"><span class="duration">' + dur + '</span> - <span class="ven">' + event.room.toUpperCase() + '</span><span class="competition">' + event.selection + '</span></div>');
          }
        },
        viewRender: function (view) {
            // limit the min date and max date of the calendar, and change the programmation calendar date
            var moment = $('#mycalendar').fullCalendar('getDate');

            $('#mycalendar .fc-left, #mycalendar .fc-right').removeClass('hide');

            if (moment.format('DD') > maxDate) {
              $('#mycalendar').fullCalendar('gotoDate', '2016-05-22');
            }
            if (moment.format('DD') < minDate) {
              $('#mycalendar').fullCalendar('gotoDate', '2016-05-11');
            }

            if (parseInt(moment.format('DD')) + 4 >= maxDate) {
              $('#mycalendar .fc-right').addClass('hide');
            }
            if (moment.format('DD') < (parseInt(minDate) + 1)) {
              $('#mycalendar .fc-left').addClass('hide');
            }

            var m = $('#mycalendar').fullCalendar('getDate');
            $('#timeline a').each(function () {
              var d = $(this).data('date');
              if (d == m.format()) {
                $(this).trigger('click');
              }
            });
          }
      });

    } else {
      // if cookie drag doesn't exist, add class to show message
      if (!$.cookie('drag') && events.length == 0) {
        $('#calendar-wrapper').addClass('drag');
      }

      // on click on "ok" button, remove class and add cookie
      $('#okDrag').on('click', function () {
        $('#calendar-wrapper').removeClass('drag');
        $.cookie('drag', '1', {
          expires: 365
        });
      });

      $(window).resize(function () {
        $('#calendar-wrapper').css('left', $('#calendar').offset().left);
      });

      // create the 'my calendar' module
      $('#mycalendar').fullCalendar({
        lang: GLOBALS.locale, // TODO a verifier
        defaultDate: GLOBALS.defaultDate, // TODO a supprimer
        header: {
          left: 'prev',
          center: 'title',
          right: 'next'
        },
        titleFormat: 'dddd DD MMMM',
        defaultView: 'agendaDay',
        minTime: "08:00:00",
        maxTime: "28:00:00",
        allDaySlot: false,
        droppable: true,
        selectOverlap: false,
        events: events,
        eventOverlap: false,
        slotEventOverlap: false,
        eventAfterRender: function (event, element, view) {
          // atfer render of each event : change html with all the info
          if (event.duration / 60 < 2) {
            $(element).addClass('one-hour');
          }
          var dur = event.duration / 60 + 'H';
          var c = event.eventColor;
          $(element).empty();
          $(element).addClass(event.eventPictogram).addClass('ajax');
          $(element).attr('data-id', event.id);

          if (c == '#000') {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-seance-presse"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#9b9b9b") {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-seance"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#a68851") {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_evt-conference"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          } else if (c == "#fff") {
            $(element).append('<span class="category" style="background-color:' + c + ';color:#000;"><i class="icon icon_evt-personnel"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close" style="color:#000;"></i></a></span>');
          } else {
            $(element).append('<span class="category" style="background-color:' + c + '"><i class="icon icon_espace-presse"></i>' + event.type + '<a href="#" class="del"><i class="icon icon_close"></i></a></span>');
          }
          if (c == "#fff") {
            $(element).append('<div class="info"><div class="txt" style="margin-left:10px"><span>' + event.title + '</span></div></div>');
          }else{
            $(element).append('<div class="info"><img src="' + event.picture + '" /><div class="txt"><span>' + event.title + '</span><strong>' + event.author + '</strong></div></div>');
          }

          if (c == "#fff") {
            $(element).append('<div class="bottom"><span class="duration">' + dur + '</span> - <span class="ven">' + event.room.toUpperCase() + '</span></div>');
          }else{
            $(element).append('<div class="bottom"><span class="duration">' + dur + '</span> - <span class="ven">' + event.room.toUpperCase() + '</span><span class="competition">' + event.selection + '</span></div>');
          }
        },
        eventClick: function (event, jsEvent, view) {
          if ($(jsEvent.target).hasClass('del') || $(jsEvent.target).hasClass('icon_close')) {
            return;
          } else {
            openPopinEvent(event.url);
            return false;
          }
        },
        viewRender: function (view) {
          // limit the min date and max date of the calendar, and change the programmation calendar date
          var moment = $('#mycalendar').fullCalendar('getDate');

          $('#mycalendar .fc-left, #mycalendar .fc-right').removeClass('hide');

          if (moment.format('DD') > maxDate) {
            $('#mycalendar').fullCalendar('gotoDate', '2016-05-22');
          }
          if (moment.format('DD') < minDate) {
            $('#mycalendar').fullCalendar('gotoDate', '2016-05-11');
          }

          if (moment.format('DD') == maxDate) {
            $('#mycalendar .fc-right').addClass('hide');
          }
          if (moment.format('DD') == minDate) {
            $('#mycalendar .fc-left').addClass('hide');
          }

          var m = $('#mycalendar').fullCalendar('getDate');
          $('#dateProgram').text(m.format('DD MMMM YYYY'));
          $('#timeline a').each(function () {
            var d = $(this).data('date');
            if (d == m.format()) {
              $(this).trigger('click');
            }
          });
        },
        drop: function () {
          $.cookie('drag', '1', {
            expires: 365
          });
          // retrieve the dropped element's stored Event Object
          var originalEventObject = $(this).data('eventObject');

          // we need to copy it, so that multiple events don't have a reference to the same object
          var copiedEventObject = $.extend({}, originalEventObject);

          // assign it the date that was reported
          copiedEventObject.start = copiedEventObject.start;

          if (events.filter(function (e) {
              return e.id == copiedEventObject.id;
            }).length > 0) {
            return false;
          }

          // render the event on the calendar
          $('#mycalendar').fullCalendar('renderEvent', copiedEventObject, true);


          // get local storage
          var agenda = localStorage.getItem('agenda_press');

          if (agenda == null) {
            // add the event and store
            events.push(copiedEventObject);

            localStorage.setItem('agenda_press', JSON.stringify(events));
          } else {
            // get events, add the event and store
            events = JSON.parse(agenda);
            events.push(copiedEventObject);

            localStorage.setItem('agenda_press', JSON.stringify(events));
          }

          // update popin-event if needed
          if ($('.events-container').length) {
            $('.events-container .fc-event').each(function () {
              var id = $(this).data('id'),
                $this = $(this);

              for (var i = 0; i < events.length; i++) {
                if (id == events[i].id) {
                  $this.parent().addClass('delete');
                  $this.parent().find('.button').removeClass('add').text(GLOBALS.texts.agenda.delete);
                }
              }
            });
          }

        }
      });

      if ($('.communiques').length) {
        function resizeGridNews() {
          var w = 0;

          $('.communiques article').each(function () {
            if ($(this).css('display') != 'none') {
              w += $(this).outerWidth();
            }
          });
          $('.communiques .grid-wrapper').width(w / 2);
        }

        resizeGridNews();
        $(window).resize(function () {
          resizeGridNews();
        });
      }

      if ($('#calendar-programmation').length) {

        $('#calendar-programmation .calendar').on('click', '.fc-event', function (e) {
          var url = $(this).data('url');

          // load the url of the event via ajax
          openPopinEvent(url);
        });

        // delete event
        $('#calendar-programmation').on('click', '.event.delete .button', function (e) {
          e.preventDefault();

          var id = parseInt($(this).parent().find('.fc-event').data('id'));

          $('#mycalendar').fullCalendar('removeEvents', id);

          var agenda = localStorage.getItem('agenda_press');
          events = JSON.parse(agenda);

          for (var i = 0; i < events.length; i++) {
            if (events[i].id == id) {
              events.splice(i, 1);
            }
          }

          localStorage.setItem('agenda_press', JSON.stringify(events));

          $(this).parent().removeClass('delete');
          $(this).text('Ajouter').addClass('add');
        });

        // add event
        $('#calendar-programmation').on('click', '.event .add', function (e) {
          e.preventDefault();
          var $ev = $(this).parent().find('.fc-event');

          $.cookie('drag', '1', {
            expires: 365
          });
          // retrieve the dropped element's stored Event Object
          var originalEventObject = $ev.data('eventObject');

          // we need to copy it, so that multiple events don't have a reference to the same object
          var copiedEventObject = $.extend({}, originalEventObject);

          // assign it the date that was reported
          copiedEventObject.start = copiedEventObject.start;

          if (events.filter(function (e) {
              return e.id == copiedEventObject.id;
            }).length > 0) {
            return false;
          }

          // render the event on the calendar
          $('#mycalendar').fullCalendar('renderEvent', copiedEventObject, true);


          // get local storage
          var agenda = localStorage.getItem('agenda_press');

          if (agenda == null) {
            events.push(copiedEventObject);

            localStorage.setItem('agenda_press', JSON.stringify(events));
          } else {
            events = JSON.parse(agenda);
            events.push(copiedEventObject);

            localStorage.setItem('agenda_press', JSON.stringify(events));
          }

          $(this).parent().addClass('delete');
          $(this).removeClass('add').text(GLOBALS.texts.agenda.delete);
        });

        // close popin
        $('#calendar-programmation').on('click', '.close-button', function (e) {
          e.preventDefault();

          $('.popin-event').removeClass('show');
          setTimeout(function () {
            $('.popin-event').remove();
          }, 600);
        });

        function initDraggable() {
          $('#calendar-programmation .fc-event').each(function () {

            // based on time start and duration, calculate positions of event
            var timeStart = $(this).data('time'),
              dur = Math.floor($(this).data('duration') / 60),
              minutes = $(this).data('duration') % 60;

            if (minutes == 0) {
              minutes = '';
            }

            if (dur < 2) {
              $(this).addClass('one-hour');
              $(this).find('.txt span').prepend(dur + 'H' + minutes + ' - ');
            }

            var base = 8;
            $(this).find('.category').css('background-color', $(this).data('color'));
            $(this).addClass($(this).data('picto').substr(1));

            var mT = timeStart - base;
            $(this).css('margin-top', (mT * 80) + 5);

            // init all the data of the event
            var eventObject = {
              title: $(this).find('.txt span').text(),
              eventColor: $(this).data('color'),
              start: $(this).data('start'),
              end: $(this).data('end'),
              type: $(this).find('.category').text(),
              author: $(this).find('.txt strong').text(),
              picture: $(this).find('img').attr('src'),
              duration: parseInt($(this).find('.bottom .duration').text().substr(0, 2)) * 60,
              room: $(this).find('.bottom .ven').text(),
              selection: $(this).find('.bottom .competition').text(),
              eventPictogram: $(this).data('picto').substr(1),
              id: $(this).data('id'),
              url: $(this).data('url')
            };

            // store the Event Object in the DOM element so we can get to it later
            $(this).data('eventObject', eventObject);

            // make the event draggable using jQuery UI
            if (!$(this).parent().hasClass('event')) {
              $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                start: function () {
                  $('#calendar-wrapper').removeClass('drag');
                },
                stop: function (event, ui) {
                  setTimeout(function () {
                    if (!$.cookie('drag')) {
                      $('#calendar-wrapper').addClass('drag');
                    }
                  }, 300);
                }
              });
            }

          });
        }

        // on click on the timeline link, update calendar
        $('#timeline a').on('click', function (e) {
          e.preventDefault();

          if ($(this).hasClass('active') || $(this).hasClass('disabled')) {
            return false;
          }

          $('#timeline a').removeClass('active');
          $(this).addClass('active');

          $.ajax({
            type: "GET",
            dataType: "html",
            cache: false,
            url: GLOBALS.urls.calendarProgrammationUrl,
            success: function (data) {
              $('.v-wrapper').html(data);

              initDraggable();
            }
          });

          var date = $.fullCalendar.moment($(this).data('date'));

          $('#dateProgram').text(date.format('DD MMMM YYYY'));

          $('#mycalendar').fullCalendar('gotoDate', date);

        });

        var ct = 0;

        $('#calendar-programmation .nav.prev').addClass('hide');

        // slider calendar programmation
        $('#calendar-programmation .nav').on('click', function (e) {
          e.preventDefault();
          $('#calendar-programmation .nav').removeClass('hide');

          if ($(this).hasClass('prev')) {
            $('.v-wrapper').removeClass('max');

            var $v = $('.venue').eq(ct);
            if ($v.prev().length) {
              var p = -($v.width() * (ct - 1));
              $('.v-wrapper').css({
                '-webkit-transform': 'translateX(' + p + 'px)',
                '-moz-transform': 'translateX(' + p + 'px)',
                '-o-transform': 'translateX(' + p + 'px)',
                '-ms-transform': 'translateX(' + p + 'px)',
                'transform': 'translateX(' + p + 'px)'
              });
              ct--;
            }

            if ($v.prev().prev().length == 0) {
              $(this).addClass('hide');
            }
          } else {
            var $v = $('.venue').eq(ct);
            var p = -($v.width() * (ct + 1));
            var max = $('.venues').width() - ($('.wrapper').width() - $('.timeCol').width());
            if (!$('.v-wrapper').hasClass('max')) {
              ct++;
            }

            if (-p > max) {
              p = -max;
              $('.v-wrapper').addClass('max');
              $(this).addClass('hide');
            } else {
              $('.v-wrapper').removeClass('max');
            }
            $('.v-wrapper').css({
              '-webkit-transform': 'translateX(' + p + 'px)',
              '-moz-transform': 'translateX(' + p + 'px)',
              '-o-transform': 'translateX(' + p + 'px)',
              '-ms-transform': 'translateX(' + p + 'px)',
              'transform': 'translateX(' + p + 'px)'
            });
          }
        });

        initDraggable();
      }
    }
  }

  // delete event
  $('#mycalendar').on('click', '.fc-event .category a', function (e) {
    e.preventDefault();

    var id = $(this).parents('.fc-event').data('id');
    $('#mycalendar').fullCalendar('removeEvents', id);

    var agenda = localStorage.getItem('agenda_press');
    events = JSON.parse(agenda);

    for (var i = 0; i < events.length; i++) {
      if (events[i].id == id) {
        events.splice(i, 1);
      }
    }

    localStorage.setItem('agenda_press', JSON.stringify(events));

    if ($('.events-container').length) {

      $('.events-container .event').removeClass('delete');
      $('.events-container .event .button').addClass('add').text('Ajouter');

      $('.events-container .fc-event').each(function () {
        var id = $(this).data('id'),
          $this = $(this);

        for (var i = 0; i < events.length; i++) {
          if (id == events[i].id) {
            $this.parent().addClass('delete');
            $this.parent().find('.button').removeClass('add').text(GLOBALS.texts.agenda.delete);
          }
        }
      });
    }

  });


  // EVENT AJAX COMMUNIQUE AND INFORMATION //

  if ($('.press').length) {

    popinInit();

    var $container = $('#gridAudios'),
      $grid;

    $grid = $('#gridAudios').imagesLoaded(function () {
      // init Isotope after all images have loaded
      setGrid($grid, $('#gridAudios'), true);
      $grid.isotope({
        itemSelector: '.item',
        percentPosition: true,
        layoutMode: 'packery',
        packery: {
          columnWidth: '.grid-sizer'
        }
      });

      $grid.isotope('layout');
    });
    $('.press .read-more').on('click', function (e) {
      e.preventDefault();
      $(this).hide();
      $.ajax({
        type: "GET",
        dataType: "html",
        cache: false,
        url: GLOBALS.urls.loadPressRelease,
        success: function (data) {
          var $data = $(data).find('.gridelement');
          var $container = $('#gridAudios'),
            $grid;
          $grid = $container.imagesLoaded(function () {
            setGrid($grid, $data, false);
          });
        }
      });
    });
  }

  // POPIN LOCK //

  function popinInit() {

    if ($('.press.lock').length && !$('.connected').length) {

      if ($('#popin-press').length) {

        $('.buttons:not(".active-btn")').on('click', function () {

          if ($('#popin-press').hasClass('visible-popin')) {
            $('#popin-press').removeClass('visible-popin');

            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
          } else {
            $('#popin-press').addClass("visible-popin");
            $("#main").addClass('overlay-popin');
          }
          return false;
        });

        $(document).keyup(function (e) {
          if (e.keyCode == 27) {
            $('#popin-press').removeClass('visible-popin');
            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
            $('.overlay-div').remove();
          }
        });
      }

      $(document).on('click',function (e) {

        var $element = $(e.target);
        if ($element.hasClass('visible-popin')) {

        } else {
          var $isPopin = $element.closest('.visible-popin');
          var isButton = $element.hasClass('buttons');

          if ($isPopin.length || isButton) {

          } else {
            $('#popin-press').removeClass('visible-popin');
            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');

          }
        }
      });

        var isiPad = navigator.userAgent.match(/iPad/i) != null;

        if(isiPad){
          $(document).on('touchstart',function (e) {

            var $element = $(e.target);
            if ($element.hasClass('visible-popin')) {

            } else {
              var $isPopin = $element.closest('.visible-popin');
              var isButton = $element.hasClass('buttons');

              if ($isPopin.length || isButton) {

              } else {
                $('#popin-press').removeClass('visible-popin');
                $("#main").removeClass('overlay-popin');
                $('footer').removeClass('overlay');

              }
            }
          });
        }

    }

    // POPIN DOWNLOAD //

    //ONLY FOR MEDIA//
    if ($('.press.lock').length && !$('.connected').length && $('.press-media').length ) {
      if ($('#popin-download-press').length) {
        $('.buttons.active-btn').on('click', function () {

          if ($('#popin-download-press').hasClass('visible-popin')) {
            $('#popin-download-press').removeClass('visible-popin');

            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
          } else {

            $('#popin-download-press').addClass("visible-popin");
            $("#main").addClass('overlay-popin');

          }
          return false;

        });

        $(document).keyup(function (e) {
          //        if (e.keyCode == 13) $('.save').click();
          if (e.keyCode == 27) {
            $('#popin-download-press').removeClass('visible-popin');
            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
            $('.overlay-div').remove();
          }
        });

        $(document).on('click', function (e) {

          var $element = $(e.target);
          if ($element.hasClass('visible-popin')) {

          } else {
            var $isPopin = $element.closest('.visible-popin');
            var isButton = $element.hasClass('buttons');

            if ($isPopin.length || isButton) {

            } else {
              $('#popin-download-press').removeClass('visible-popin');
              $("#main").removeClass('overlay-popin');
              $('footer').removeClass('overlay');
            }
          }
        });

        var isiPad = navigator.userAgent.match(/iPad/i) != null;

        if(isiPad){
          $(document).on('touchstart', function (e) {

            var $element = $(e.target);
            if ($element.hasClass('visible-popin')) {

            } else {
              var $isPopin = $element.closest('.visible-popin');
              var isButton = $element.hasClass('buttons');

              if ($isPopin.length || isButton) {

              } else {
                $('#popin-download-press').removeClass('visible-popin');
                $("#main").removeClass('overlay-popin');
                $('footer').removeClass('overlay');
              }
            }
          });
        }
      }
    }

    //FOR ALL PRESS PAGE//
    if (!$('.lock').length) {
      if ($('#popin-download-press').length) {
        $('.buttons').on('click', function () {

          if ($('#popin-download-press').hasClass('visible-popin')) {
            $('#popin-download-press').removeClass('visible-popin');

            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
          } else {

            $('#popin-download-press').addClass("visible-popin");
            $("#main").addClass('overlay-popin');

          }
          return false;

        });

        $(document).keyup(function (e) {
          //        if (e.keyCode == 13) $('.save').click();
          if (e.keyCode == 27) {
            $('#popin-download-press').removeClass('visible-popin');
            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');
            $('.overlay-div').remove();
          }
        });

        $(document).on('click', function (e) {

          var $element = $(e.target);
          if ($element.hasClass('visible-popin')) {
            //do nothing
          } else {
            var $isPopin = $element.closest('.visible-popin');
            var isButton = $element.hasClass('buttons');

            if ($isPopin.length || isButton) {
              //do nothing
            } else {
              $('#popin-download-press').removeClass('visible-popin');
              $("#main").removeClass('overlay-popin');
              $('footer').removeClass('overlay');
            }
          }
        });
        var isiPad = navigator.userAgent.match(/iPad/i) != null;

        if(isiPad){
          $(document).on('touchstart', function (e) {

            var $element = $(e.target);
            if ($element.hasClass('visible-popin')) {
              //do nothing
            } else {
              var $isPopin = $element.closest('.visible-popin');
              var isButton = $element.hasClass('buttons');

              if ($isPopin.length || isButton) {
                //do nothing
              } else {
                $('#popin-download-press').removeClass('visible-popin');
                $("#main").removeClass('overlay-popin');
                $('footer').removeClass('overlay');
              }
            }
          });
        }
      }
    }
  }

  // POPIN CALENDAR CREAT EVENT //

  if ($('#create-event-pop').length) {

    function getFormData($form){
        var unindexed_array = $form.serializeArray();
        var indexed_array = {};

        $.map(unindexed_array, function(n, i){
            indexed_array[n['name']] = n['value'];
        });

        return indexed_array;
    }

    $('.create').on('click', function () {
      $('#create-event-pop').addClass("visible-popin");

      $('#form_data').on('submit',function(e){

        e.preventDefault;

        //vrification des donnes reues//
         $('#create-event-pop input[type=text]').each(function(index,value){

           if($(this).val() == ""){
             $(this).addClass('error');
           }else{
            if($(this).hasClass('error')){
              $(this).removeClass('error');
            }
           }
         });

         if(!$('#create-event-pop input[type=text]').hasClass('error')){

            $('#create-event-pop').removeClass("visible-popin");

           //rcupration des donnes sous forme de JSON//
           var $form = $(this);
           var data = getFormData($form);
           console.log(data);

           date1 = data.datebegin;
           date1 = date1.replace(/\//g,'-');

           hour1 = data.hoursbegin;
           hour1 = hour1.replace('h',':');

           date1 = date1+"T"+hour1+":00";


           date2 = data.dateend;
           date2 = date2.replace(/\//g,'-');

           hour2 = data.hoursend;
           hour2 = hour2.replace('h',':');

           date2 = date2+"T"+hour2+":00";


           var dateBegin = new Date(date1);
           var dateEnd = new Date(date2);

           //Cration de l'vnement et affichage sur le calendrier
           var myEvent = {

               "title": data.title,
               "eventColor": "#fff",
               "start": dateBegin,
               "end": dateEnd,
               "type": data.title,
               "duration": (dateEnd-dateBegin)/60000,
               "room": data.place,
               "eventPictogram": "pen",
               "id": 5,
               "url": "eventPopin.html"
           };
           $('#mycalendar').fullCalendar( 'renderEvent', myEvent );

           $(this)[0].reset();

           //Stockage de l'vnement dans le storage
           //ici


           // get local storage
           var agenda = localStorage.getItem('agenda_press');

           if (agenda == null) {
             // add the event and store
             events.push(myEvent);

             localStorage.setItem('agenda_press', JSON.stringify(events));
           } else {
             // get events, add the event and store
             events = JSON.parse(agenda);
             events.push(myEvent);

             localStorage.setItem('agenda_press', JSON.stringify(events));
           }

         }
         return false;

      });

    });

    $(document).keyup(function (e) {

      if (e.keyCode == 27) {
        $('#create-event-pop').removeClass('visible-popin');
      }
    });
    $('.btn-close').on('click', function () {
      $('#create-event-pop').removeClass('visible-popin');
    });


  }

  // POPIN Show event //

  if ($('.fullcalendar').length) {
    $('.fc-event-container').on('click', function (e) {
      var url = $(this).attr('src');

      // load the url of the event via ajax
      openPopinEvent(url);
    });
  }

  // Navigation tab press page (accreditation)

  if ($('#accreditation').length) {

    $('.nav-accre table td').click(function () {
      var $cat = $(this).data('cat');
      var sectionIsShow = $('#accreditation').find('.nav-container.active');
      var sectionShow = $('#accreditation').find('.nav-container[data-cat=' + $cat + ']');

      if (!$(this).hasClass('active')) {

        $('.nav-accre table').find('.active').removeClass('active');
        $(this).addClass('active');

        sectionIsShow.animate({
          opacity: 0
        }, 500, function () {
          sectionIsShow.css('display', 'none');
          sectionIsShow.removeClass('active');

          sectionShow.css('opacity', 0);
          sectionShow.css('display', 'block');

          sectionShow.animate({
            opacity: 1
          }, 500, function () {
            sectionShow.addClass('active');
          })
        });
      }
    });
  }

  //Mediatheque nav
  if ($('.press-media').length) {
    menuMedia();
    initSlideshows();
  }

  if ($('.downloading-press').length) {
    initSlideshows();
  }

  //mediatheque AJAX
  function ajaxEvent() {
    $('.press-media .nav-mediapress td').on('click', function (e) {
      e.preventDefault();
      if ($(this).is(':not(.active)')) {
        var urlPath = $(this).data('cat');
        $.get(urlPath, function (data) {
          $(".nav-container").html($(data).find('.nav-container'));
          history.pushState('', GLOBALS.texts.url.title, urlPath);
          ajaxEvent();
          menuMedia();
          initSlideshows();
          popinInit();
        });
        $('.press-media .nav-mediapress').find('td.active').removeClass('active');
        $(this).addClass('active');
      }
    });
  }

  function menuMedia() {
    var $info = $('.info, .media, .plus');
    $info.click(function () {
      var $active = $('.press-media .nav-container .table .line').find('.active');
      var $parent = $(this).closest(".container");
      if (!$parent.hasClass('active')) {
        $active.removeClass('active');
        $parent.addClass('active');
        $('.icon_moins').removeClass('icon_moins').addClass('icon_case-plus');
        $parent.find('.icon_case-plus').removeClass('icon_case-plus').addClass('icon_moins');
      } else {
        $active.removeClass('active');
        $parent.find('.icon_moins').removeClass('icon_moins').addClass('icon_case-plus');
      }
    });
  }

  ajaxEvent();

  //Grid
  if ($('.gridPressDownload').length) {
    $grid = $('.gridPressDownload').imagesLoaded(function () {
      $grid.isotope({
        layoutMode: 'packery',
        itemSelector: '.item',
        packery: {
          gutter: 20
        }
      });
    });
  }

  //downloding nav sticky
  if ($('.downloading-press').length) {
    //Scroll
    $(window).on('scroll', function () {

      var s = $(window).scrollTop(),
        h = $("#main").height() - 180,
        affiche = $('#affiche-officielle').offset().top - 180,
        signature = $('#signature').offset().top - 180,
        animation = $('#animation').offset().top - 180,
        photosInst = $('#photos-institutionnelles').offset().top - 180,
        dossierPress = $('#dossier-presse').offset().top - 180;

      if (s > 180) {
        $('.downloading-nav').addClass('sticky');
        $(".downloading-nav").css({
          position: "fixed",
          top: 90,
          width: "100%",
          zIndex: 5
        });
      } else if (s < 180) {
        $(".downloading-nav").css({
          position: "relative",
          top: 1,
          zIndex: 1
        });
      }

      if (s > affiche && s < signature) {
        $('.downloading-nav').find('.active').removeClass('active');
        $('a[href="#affiche-officielle"]').addClass('active');

      } else if (s > signature && s < animation) {
        $('.downloading-nav').find('.active').removeClass('active');
        $('a[href="#signature"]').addClass('active');

      } else if (s > animation && s < photosInst) {
        $('.downloading-nav').find('.active').removeClass('active');
        $('a[href="#animation"]').addClass('active');

      } else if (s > photosInst && s < dossierPress) {
        $('.downloading-nav').find('.active').removeClass('active');
        $('a[href="#photos-institutionnelles"]').addClass('active');
      } else if (s > dossierPress) {
        $('.downloading-nav').find('.active').removeClass('active');
        $('a[href="#dossier-presse"]').addClass('active');
      }

    });


    $('a[href^="#"]').click(function () {

      var is_sticky = $('.press').hasClass('sticky');
      var the_id = $(this).attr("href");

      if (!is_sticky) {

        $('html, body').animate({
          scrollTop: $(the_id).offset().top - 300
        }, 'slow');
        return false;

      } else {

        $('html, body').animate({
          scrollTop: $(the_id).offset().top - 130
        }, 'slow');
        return false;

      }
    });

  }

  if ($('.fullcalendar #mycalendar').length) {
    // Fonction excute au redimensionnement
    function resizeCalendar() {
      var result = document.getElementById('result');
      if ("matchMedia" in window) {
        if (window.matchMedia("(min-width:1650px)").matches) {
          // au dessus de 1650, calendrier  6 jour
          $('#mycalendar').fullCalendar('changeView', 'agendaWeek');
        }
        if (window.matchMedia("(max-width:1650px)").matches && window.matchMedia("(min-width:1401px)").matches) {
          // calendrier de 5 jours
          $('#mycalendar').fullCalendar('changeView', 'agendaFive');
        }
        if (window.matchMedia("(max-width:1400px)").matches && window.matchMedia("(min-width:1181px)").matches) {
          // calendrier de 4 jours
          $('#mycalendar').fullCalendar('changeView', 'agendaFour');
        }
        if (window.matchMedia("(max-width:1180px)").matches) {
          // calendrier de 3 jours
          $('#mycalendar').fullCalendar('changeView', 'agendaThree');
        }
      }
    }
    // On lie l'vnement resize  la fonction
    window.addEventListener('resize', resizeCalendar, false);

    //init
    if (window.matchMedia("(min-width:1650px)").matches) {
      // au dessus de 1650, calendrier  6 jour
      $('#mycalendar').fullCalendar('changeView', 'agendaWeek');

    }
    if (window.matchMedia("(max-width:1650px)").matches && window.matchMedia("(min-width:1401px)").matches) {
      // calendrier de 5 jours
      $('#mycalendar').fullCalendar('changeView', 'agendaFive');

    }
    if (window.matchMedia("(max-width:1400px)").matches && window.matchMedia("(min-width:1181px)").matches) {
      // calendrier de 4 jours
      $('#mycalendar').fullCalendar('changeView', 'agendaFour');
    }
    if (window.matchMedia("(max-width:1180px)").matches) {
      // calendrier de 3 jours
      $('#mycalendar').fullCalendar('changeView', 'agendaThree');
    }

  }


  //Pikaday init//
  var minDatePicker = new Date(2016,4,11);
  var maxDatePicker = new Date(2016,4,22);

  var pickerBegin = new Pikaday({
      field: document.getElementById('datepickerBegin'),
      format: 'YYYY/MM/D',
      formatSubmit: 'yyyy-mm-dd',
      hiddenSuffix: '',
      minDate: minDatePicker,
      firstDay: 1,
      maxDate: maxDatePicker,
      i18n: {
          previousMonth : 'Previous Month',
          nextMonth     : 'Next Month',
          months        : GLOBALS.calendar.i18n.months,
          weekdays      : GLOBALS.calendar.i18n.weekdays,
          weekdaysShort : GLOBALS.calendar.i18n.weekdaysShort
      }
  });


  var pickerEnd = new Pikaday({
      field: document.getElementById('datepickerEnd'),
      format: 'YYYY/MM/D',
      minDate: minDatePicker,
      maxDate: maxDatePicker,
      firstDay: 1,
      i18n: {
          previousMonth : 'Previous Month',
          nextMonth     : 'Next Month',
          months        : GLOBALS.calendar.i18n.months,
          weekdays      : GLOBALS.calendar.i18n.weekdays,
          weekdaysShort : GLOBALS.calendar.i18n.weekdaysShort
      }
  });

var time = $('.hours').timepicker({
  timeFormat: typeof GLOBALS.calendar.i18n.labelFormat[GLOBALS.locale] !== "undefined" ? GLOBALS.calendar.i18n.labelFormat[GLOBALS.locale] : GLOBALS.calendar.i18n.labelFormat.default
});

});
;
$(document).ready(function() {

  $(window).on('resize', function() {
    if($('.home').length) {
      setHeightSlider();
    }
    if($('.grid').length) {
      resizeGrid();
      setTimeout(function() {
        resizeGrid();
      }, 300);
    }
    if($('#prehome-container').length) {
      $('#prehome-container').height($(window).height());
    }
    var pxT = parseInt(($('#selection .owl-stage-outer').width() / 2) - 131) + "px";
    $('#selection .owl-stage').css('transform', 'translate3d(' + pxT + ',0, 0)');
  });

  if (navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {
    $('body').addClass('mob');
  }

  var dragging = false;

  $("body").on("touchmove", function(){
      dragging = true;
  });

  $('body').on('touchend', 'a', function(e) {
    if($(this).hasClass('read-more')) return;
    if($(this).hasClass('ajax') && !$(this).hasClass('chocolat-image')) return;
    if($(this).hasClass('selection')) return;
    if($(this).hasClass('read-later')) return;
    if($(this).hasClass('playpause')) return;
    if (dragging) return;
    $(this).trigger('click');
  });

  $("body").on("touchstart", function(){
      dragging = false;
  });
});;
function closeSearch() {
  $('#main, footer').removeClass('overlay');
  $('#searchContainer').css({
    minHeight : 0,
    maxHeight: 0
  });
  $('.search').removeClass('opened');
}

$(document).ready(function() {

  // Search
  // =========================

  function openSearch() {
    $('#main, footer').addClass('overlay');
    $('#searchContainer').css({
      minHeight : $(window).height() - 91,
      maxHeight: '8000px'
    });
    $('#inputSearch').focus();
  }  

  $('body').on('click', '#suggest li', function(e) {
    var link = $(this).data('link');

    window.location = link;
  });

  $('.suggestSearch').on('input', function(e) {
    var value = $(this).val();
    var $suggest = $(this).parent().next();
    var noWhitespaceValue = value.replace(/\s+/g, '');
    var noWhitespaceCount = noWhitespaceValue.length;
    if($('.searchpage').length) {
      $suggest = $('#main #suggest');
    }
    if(value == '') {
      $suggest.empty();
      return false;
    }
    if (noWhitespaceCount % 3 === 0) {

      $suggest.empty();

      $.ajax({
        type: "GET",
        url: 'searchsuggest.json', //TODO a revoir//
        success: function(data) {

          for (var i=0; i<data.length; i++) {
            var type = data[i].type,
                name = data[i].name,
                link = data[i].link;

            var txt = name.toLowerCase();

            txt = txt.replace(value.toLowerCase(), '<strong>' + value.toLowerCase() + '</strong>');

            $suggest.append('<li data-link="' + link + '"><span>' + type + '</span>' + txt + '</li>');
          }
        }
      });
    }

    
  });

  $('.search').on('click', function(e) {
    e.preventDefault();
    if($('.searchpage').length) {
      return false;
    }

    if($(this).hasClass('opened')) {
      closeSearch();
      return false;
    } else {
      openSearch();
    }

    $('.search').toggleClass('opened');
  });

  if($('.searchpage').length) {

      $('#colSearch').css('left', ($(window).width() - 977) / 2);
    
    $( window ).resize( function(){
      $('#colSearch').css('left', ($(window).width() - 977) / 2);
    });

    $('#colSearch a, .view-all').on('click', function(e) {
      e.preventDefault();

      var $this = $(this);

      $('#colSearch a').removeClass('active');
      
      if($this.parents('#colSearch').length != 0) {
        $this.addClass('active');
      } else {
        var cl = $this.data('class');
        $('#colSearch a').each(function() {
          if($(this).hasClass(cl)) {
            $(this).addClass('active');
          }
        });
      }

      $('html, body').animate({
        scrollTop: 0
      }, 500);

      $('.resultWrapper, #filtered').fadeOut(500, function() {

        setTimeout(function() {

          if($this.hasClass('all')) {
            $('.resultWrapper').fadeIn();
            return false;
          }

          var $activeEl = $('#colSearch a.active');

          if($activeEl.hasClass('artists') || $activeEl.hasClass('events') || $activeEl.hasClass('films') || $activeEl.hasClass('participate')) {
            $('.filters').hide();
          } else {
            $('.filters').show();
          }

          $('#filteredContent').empty();
          var url = $this.data('ajax');

          $.ajax({
            type: "GET",
            url: url,
            success: function(data) {
              $('#filteredContent').html(data);
              $('#filtered').fadeIn();

              $('#filteredContent').infinitescroll({
                navSelector: ".next:last",
                nextSelector: ".next:last",
                itemSelector: ".infinite",
                debug: false,
                dataType: 'html',
                path: function(index) {
                  if($('.next:last').attr('href') == '#') {
                    return false;
                  }
                  return $('.next:last').attr('href');
                }
              });
            }
          });

        }, 700);
      });
    });

    // test : remove once on server
    if($('.searchpage #inputSearch').val() == 'Lonardo Di Caprio') { //TODO a revoir//
      $('#noResult').show();
      $('#count span').text('0');
      return false;
    }

    $.ajax({
      type: "GET",
      url: 'results.json', //TODO  a revoir//
      success: function(data) {

        if(data.all.count == 0) {
          $('#noResult').show();
          return false;
        } else {
          $('.resultWrapper').show();
          $('#count span, #colSearch .all span').text(data.all.count);

          // ARTISTS
          var artists = data.persons;
          $('#colSearch .artists span').text(artists.count);

          // FILMS
          var films = data.films;
          $('#colSearch .films span').text(films.count);

          // FILMS
          var medias = data.medias;
          $('#colSearch .medias span').text(medias.count);

          // NEWS
          var news = data.news;
          $('#colSearch .news span').text(news.count);

          // COMMUNIQUES
          var communiques = data.communiques;
          $('#colSearch .communiques span').text(communiques.count);

          // EVENTS
          var events = data.events;
          $('#colSearch .events span').text(events.count);

          // PARTICIPATE
          var participate = data.participate;
          $('#colSearch .participate span').text(participate.count);
        }
      }
    });
  }

});;
$(document).ready(function() {
  if($('#seatingchart').length) {
      $('.nav-map li:not(#more-map)').on('click',function(){

        if(!$(this).hasClass('active') && !$('#main.animation').length ){

          var $this       =  $(this),
              activeLi    =  $('.nav-map').find('li.active'),
              data        =  activeLi.data('maps'),
              imgActive   =  $('.maps').find("span.active"),
              thisData    =  $this.data('maps'),
              imgNotActiv =  $('.maps').find("#"+thisData),
              moreMap     =  $('#more-map').find("img[data-image='"+thisData+"']"),
              moreMapAc   =  $('#more-map img.visible');

              $('#main').addClass('animation');

              imgActive.animate({

                opacity:0

              },600,function(){

              imgActive.removeClass('active');
              imgNotActiv.addClass('active');
              moreMap.addClass('visible');

              activeLi.removeClass('active');
              $('.icon_a-votre-service').remove();

              $this.addClass('active');
              $this.prepend('<i class="icon icon_a-votre-service"></i>');
              moreMapAc.removeClass('visible');

              imgNotActiv.animate({
                 opacity:1
              },400,function(){
                  $('#main').removeClass('animation');
              });
          });
        }
      })
    }
});
;
$(document).ready(function() {

  // Selection
  // =========================

  var sliderSelection = '',
      sliderSuggestion = '',
      tr = 0,
      selectionCookie = [];

  if($.cookie('selection')) {
    selectionCookie = JSON.parse($.cookie('selection'));

    for(var i=0; i<selectionCookie.length; i++) {
      var $art = $('#toClone').clone();

      $art.find('article').addClass(selectionCookie[i].format);
      $art.attr('id', 'article' + selectionCookie[i].id);
      $art.find('article').data('format', selectionCookie[i].format);
      $art.find('article').data('theme', selectionCookie[i].theme);
      $art.find('img').attr('src', selectionCookie[i].img);
      $art.find('.linkImage').attr('href', selectionCookie[i].link);
      $art.find('.category').text(selectionCookie[i].category);
      $art.find('.date').text(selectionCookie[i].date);
      $art.find('.hour').text(selectionCookie[i].hour);
      $art.find('h2 a').text(selectionCookie[i].title);
      $art.find('.picto').append('<i class="icon icon_'+selectionCookie[i].format+'"></i>');
      $('#slider-selection').append($art);
    }
  }

  $.ajax({
    type: "GET",
    dataType: "html",
    cache: false,
    url: GLOBALS.urls.selectionUrl ,
    success: function(data) {
      $('#slider-suggestion').append(data);

      sliderSuggestion = $("#slider-suggestion").owlCarousel({
        nav: false,
        dots: false,
        smartSpeed: 500,
        center: true,
        loop: false,
        margin: 0,
        dragEndSpeed: 900,
        autoWidth: true,
        onInitialized: function() {

       }
      });

      sliderSuggestion.owlCarousel();
    }
  });

  $('#selection .title span').text(selectionCookie.length);

  sliderSelection = $("#slider-selection").owlCarousel({
    nav: false,
    dots: false,
    smartSpeed: 500,
    center: true,
    loop: false,
    margin: 0,
    dragEndSpeed: 900,
    autoWidth: true,
    onInitialized: function() {
      if($('#selection .owl-stage').css('transform') == 'none') {
        var pxT = parseInt(($('#selection .owl-stage-outer').width() / 2) - 131) + "px";
        $('#selection .owl-stage').css('transform', 'translate3d(' + pxT + ',0, 0)');
      }
      setTimeout(function() {
        tr = $('#selection .owl-stage').css('transform').substr(19, 3);
      }, 700);
    }
  });

  sliderSelection.owlCarousel();

  function openSelection(callback) {
    $('#main, footer').addClass('overlay');

    $('#selection').addClass('open');

    $('header .selection').addClass('opened');

    if(selectionCookie.length == 0) {
      $('#slider-suggestion').addClass('show');
      $('.filters-selection a').removeClass('active');
      $('a[data-selection=suggestion]').addClass('active');
    }

    callback();

  }

  function closeSelection() {
    $('#main, footer').removeClass('overlay');
    $('#selection').removeClass('open');
    $('header .selection').removeClass('opened');
    $('#addtext').removeClass('show');
  }

  $('body').on('click', '#main.overlay', function(e) {
    e.preventDefault();

    if($('#selection').hasClass('open')) {
      closeSelection();
    }
    if($('#searchContainer').hasClass('open')) {
      closeSearch();
    }
  });

  $('body').on('click', 'footer.overlay', function(e) {
    e.preventDefault();

    if($('#selection').hasClass('open')) {
      closeSelection();
    }
  });

  $('header .selection').on('click', function(e) {
    e.preventDefault();

    if($(this).hasClass('opened')) {
      closeSelection();
    } else {
      $("#main, footer").addClass('overlay');
      openSelection(function() {

      });
    }

  });

  var widthFilter = 0;

  // filters
  $('.filters-selection a').on('click', function(e) {
    widthFilter = 0;
    e.preventDefault();

    $('.filters-selection a').removeClass('active');
    $(this).addClass('active');

    var f = $(this).data('selection');

    $('#slider-selection').addClass('fade');
    $('#selection .owl-item').removeClass('filtered');

    if(f == 'all') {
      $('#slider-suggestion').removeClass('show');
      $('#selection .owl-stage').width(272 * $('#selection .owl-item').length).css('transform', 'translate3d(' + tr + 'px, 0, 0)');
      setTimeout(function() {
        $('#selection .owl-item').removeClass('fade');
        $('#slider-selection').removeClass('fade');
      }, 1200);
      return false;
    }

    if(f == 'suggestion') {
      setTimeout(function() {
        $('#slider-suggestion').addClass('show');
      }, 1200);

      return false;
    }

    $('#slider-suggestion').removeClass('show');

    setTimeout(function() {
      $('#selection article').each(function() {
        if(!$(this).hasClass(f)) {
          $(this).parents('.owl-item').addClass('fade filtered');
        }
      });
      $('#selection .owl-stage').width(272 * $('#selection .owl-item').not('.filtered').length).css('transform', 'translate3d(' + tr +'px, 0, 0)');
      $('#selection .owl-item').not('.filtered').removeClass('fade');
    }, 500);

    setTimeout(function() {
      $('#slider-selection').removeClass('fade');
    }, 800);

  });

  // delete an article
  $('body').on('click', '.delete', function(e) {
    e.preventDefault();
    var $that = $(this);

    $(this).parent().addClass('deleted');
    var i = $(this).parent().parent().index();

    var id = parseInt($(this).parent().attr('id').replace('article', ''));

    selectionCookie = selectionCookie.filter(function (el) {return el.id !== id; });

    $('#selection .title span').text(selectionCookie.length);

    $.cookie('selection', JSON.stringify(selectionCookie), { expires: 14 });

    setTimeout(function() {
      sliderSelection.trigger('del.owl.carousel', i);
      sliderSelection.trigger('refresh.owl.carousel');
    }, 800);
  });

  // add an article
  $('body').on('click', '.read-later', function(e) {
    e.preventDefault();

    if($('.mob').length) {
      var lPos = $(this).offset().left - 80;

      if(($(this).offset().left + 120) > $(window).width()) {
        lPos = $(this).offset().left - 120;
        $(this).addClass('rAlign');
      } else {
        $(this).removeClass('rAlign');
      }

      var tPos = $(this).offset().top - $(window).scrollTop() - 59;

      $('#addtext').css({
        top: tPos,
        left: lPos
      });

      $('#addtext').addClass('show');
    }


    var $article = $(this).parents('article').clone().removeClass('double').wrapAll("<div class='article'></div>").parent().wrapAll('<div></div>').parent();
        $article.find('.read-later').remove();
        $article.find('div.article').append('<a href="#" class="delete"></a>');
        $article.find('div.article').attr('id', 'article' + $(this).parents('article').index('#main article'));
        $article = $article.html();

    $articleEl = $(this).parents('article');

    $('#slider-suggestion').removeClass('show');
    $('.filters-selection a').removeClass('active');
    $('a[data-selection=all]').addClass('active');

    selectionCookie.unshift({
      'id': $articleEl.index('#main article'),
      'format': $articleEl.data('format'),
      'theme': $articleEl.data('theme'),
      'img': $articleEl.find('img').attr('src'),
      'link': $articleEl.find('.linkImage').attr('href'),
      'category': $articleEl.find('.category').text(),
      'date': $articleEl.find('.date').text(),
      'hour': $articleEl.find('.hour').text(),
      'title': $articleEl.find('h2 a, h3 a').text(),
    });

    $.cookie('selection', JSON.stringify(selectionCookie), { expires: 14 });

    $('#selection .title span').text(selectionCookie.length);

    openSelection(function() {
      $("#main, footer").addClass('overlay');
      $('header .selection').addClass('opened');

      setTimeout(function() {
        sliderSelection.trigger('add.owl.carousel', [$('<div class="owl-item added scaled">' + $article + '</div>'), 0]);
        sliderSelection.trigger('refresh.owl.carousel');

        $('.added').find('.article').width(0).css({
          transition: 'none',
          paddingRight: 0
        });
        setTimeout(function() {
          $('.added').find('.article').css({
            transition: '',
            paddingRight: '',
            width: ''
          });
        }, 200);
        setTimeout(function() {
          $('.scaled').removeClass('scaled');
          $('.added').removeClass('added');
        }, 800);
      }, 400);
    });

  });

  $('body').on('mouseover', '.read-later', function() {
    var lPos = $(this).offset().left - 80;

    if(($(this).offset().left + 120) > $(window).width()) {
      lPos = $(this).offset().left - 120;
      $(this).addClass('rAlign');
    } else {
      $(this).removeClass('rAlign');
    }

    var tPos = $(this).offset().top - $(window).scrollTop() - 59;

    $('#addtext').css({
      top: tPos,
      left: lPos
    });

    $('#addtext').addClass('show');
  });

  $('body').on('mouseout', '.read-later', function() {
    $('#addtext').removeClass('show');
  });

});
;
$(document).ready(function () {

//setup twitter
  window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };

    return t;
  }(document, "script", "twitter-wjs"));

//POPIN facebook SHARE

  $.ajaxSetup({ cache: true });
  $.getScript('//connect.facebook.net/en_US/sdk.js', function(){
    FB.init({
      appId: '{1759803224251615}',
      version: 'v2.5' // or v2.0, v2.1, v2.2, v2.3
    });
    $('#loginbutton,#feedbutton').removeAttr('disabled');
    FB.getLoginStatus(updateStatusCallback);
  });

});
;
$(document).ready(function() {

  if($('.artist').length) {
    $("#slide-artist").owlCarousel({
      nav: false,
      dots: false,
      smartSpeed: 500,
      autoWidth: true,
      loop: false,
      responsive:{
        0:{
          items: 4
        },
        1675: {
          items: 5
        }
      },
      onInitialized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slide-artist .owl-stage').css({ 'margin-left': m });
      },
      onResized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slide-artist .owl-stage').css({ 'margin-left': m });
      }
    });
  }
});;
$(document).ready(function() {

  if($('.home').length || $('.webtv').length) {

    // Slider Channels
    // =========================

    function setActiveChannels() {
      $('#slider-channels .owl-item').removeClass('center');
      $('#slider-channels .owl-item.active').first().addClass('center');
      if($('#slider-channels .owl-item.center').index() >= $('#slider-channels .owl-item').length - 4) {
        $('#slider-channels .owl-item').last().addClass('center');
      }
    }

    var sliderChannels = $("#slider-channels").owlCarousel({ 
      nav: false,
      dots: false,
      smartSpeed: 500,
      fluidSpeed: 500,
      loop: false,
      margin: 50,
      autoWidth: true,
      dragEndSpeed: 600,
      responsive:{
        0:{
          items: 3
        },
        1675: {
          items: 4
        }
      },
      onInitialized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slider-channels .owl-stage').css({ 'margin-left': m });
        setActiveChannels();
      },
      onResized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slider-channels .owl-stage').css({ 'margin-left': m });
      },
      onTranslated: function() {
        setActiveChannels();
      }
    });

    sliderChannels.owlCarousel();

    $('body').on('click', '#slider-channels .owl-item', function(e) {
      sliderChannels.trigger('to.owl.carousel', [$(this).index(), 400, true]);
    });

  }

});;
$(document).ready(function() {

  if($('.home').length) {

    // Slider Home
    // =========================
    var time = 7;
   
    var $progressBar,
        $bar, 
        sliderHome, 
        isPause, 
        tick,
        percentTime,
        deltaTooBig = false;

    function positionElements() {
      var p = ($('#slider .owl-item').width() / 2) - 200;

      $('#slider .center').prevAll().each(function() {
        $(this).find('.img').css({
          '-webkit-transform': 'translate3d(' + p + 'px, 0px, 0px)',
          '-moz-transform': 'translate3d(' + p + 'px, 0px, 0px)',
          '-o-transform': 'translate3d(' + p + 'px, 0px, 0px)',
          '-ms-transform': 'translateX(' + p+ 'px) translateY(0px)',
          'transform': 'translate3d(' + p + 'px, 0px, 0px)'
        });
      });

      setTimeout(function() {$('#slider .center .img').css({
        '-webkit-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
        '-moz-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
        '-o-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
        '-ms-transform': 'translateX(' + 0+ 'px) translateY(0px)',
        'transform': 'translate3d(' + 0 + 'px, 0px, 0px)'
      });}, 20);

      $('#slider .center').nextAll().each(function() {
        $(this).find('.img').css({
          '-webkit-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
          '-moz-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
          '-o-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
          '-ms-transform': 'translateX(-' + p+ 'px) translateY(0px)',
          'transform': 'translate3d(-' + p + 'px, 0px, 0px)'
        });
      });
    }

    function progressBar(){
      // build progress bar elements
      buildProgressBar();

      positionElements();
        
      // start counting
      start();

      $('#slider .owl-nav div').on('click', function() {
        clearTimeout(tick);

        $bar.css({
          width: '100%',
          transition: 'width .2s ease'
        });

        setTimeout(function() {
          $bar.css({
            float: 'right',
            width: 0
          });
        }, 200);
      });
    }

    function buildProgressBar(){
      $progressBar = $("<div>",{
          id:"progressBar"
      });
      
      $bar = $("<div>",{
          id:"bar"
      });
      
      $progressBar.append($bar).prependTo($("#slider"));
    }

    function start() {
      // reset timer
      percentTime = 0;
      isPause = false;
      
      // run interval every 0.01 second
      tick = setInterval(interval, 10);
    };

    function interval() {
      if(isPause === false){
        percentTime += 1 / time;
        
        $bar.css({
            width: percentTime+"%"
        });
        
        // if percentTime is equal or greater than 100
        if(percentTime >= 100){
          // slide to next item 

          clearTimeout(tick);
          $bar.css({
            float: 'right',
            width: 0,
            transition: 'width .5s ease'
          });

          $("#slider").trigger("next.owl.carousel");

          percentTime = 0;
        }
      }
    }

    // pause while dragging 
    function pauseOnDragging(){
      isPause = true;
    }

    $('body').on('click', '.owl-nav div', function(e) {
      var current = $('#slider .owl-dot.active').index(),
          newP = 0;

      if($(this).hasClass('owl-next')) {
        newP = parseInt(current) + 1;
      } else {
        newP = parseInt(current) - 1;
      }
     
      if($('#slider .owl-dot').eq(newP).length == 0 || newP == -1) {
        deltaTooBig = true;
      }
    });

    $('body').on('click', '#slider .owl-dot', function(e) {
      var delta = $(this).index() - $('#slider .owl-dot.active').index();
      if(delta < -1 || delta > 1) {
        deltaTooBig = true
      }
    });

    function move() {
      var p = ($('#slider .owl-item').width() / 2) - 200;

      $('#slider .img-container').addClass('relative');

      if(deltaTooBig) {

        $('#slider .owl-item').each(function() {
          $(this).find('.img').css({
            '-webkit-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-moz-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-o-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-ms-transform': 'translateX(' + 0+ 'px) translateY(0px)',
            'transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            'transition': 'all 0 ease'
          });
        });

      } else {

        setTimeout(function() {
          $('#slider .center').prev().find('.img').css({
            '-webkit-transform': 'translate3d(' + p + 'px, 0px, 0px)',
            '-moz-transform': 'translate3d(' + p + 'px, 0px, 0px)',
            '-o-transform': 'translate3d(' + p + 'px, 0px, 0px)',
            '-ms-transform': 'translateX(' + p+ 'px) translateY(0px)',
            'transform': 'translate3d(' + p + 'px, 0px, 0px)',
            'transition': 'all 0.5s ease'
          });

          $('#slider .center .img').css({
            '-webkit-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-moz-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-o-transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            '-ms-transform': 'translateX(' + 0+ 'px) translateY(0px)',
            'transform': 'translate3d(' + 0 + 'px, 0px, 0px)',
            'transition': 'all 0.7s ease'
          });

          $('#slider .center').next().find('.img').css({
            '-webkit-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
            '-moz-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
            '-o-transform': 'translate3d(-' + p + 'px, 0px, 0px)',
            '-ms-transform': 'translateX(-' + p+ 'px) translateY(0px)',
            'transform': 'translate3d(-' + p + 'px, 0px, 0px)',
            'transition': 'all 0.5s ease'
          });
        }, 50);
      }
    }

    // moved callback
    function moved(){
      // clear interval
      clearTimeout(tick);
        
      deltaTooBig = false;

      // start again
      start();

      $('#slider .img-container').removeClass('relative');

      $bar.css({
        float: 'none',
        width: 0,
        transition: 'none'
      });
    }

    sliderHome = $("#slider").owlCarousel({
      items: 2,
      loop: true,
      center: true,
      nav: true,
      dots: true,
      onTranslate: move,
      onInitialized: progressBar,
      onTranslated: moved,
      mouseDrag: false,
      onDrag: pauseOnDragging,
      navSpeed: 800,
      dotsSpeed: 800,
      smartSpeed: 800,
      autoWidth: true
    });

    sliderHome.owlCarousel();

    if($('.mob').length) {
      sliderHome.trigger('to.owl.carousel', [1, 100, true]);
      setTimeout(function() {
        sliderHome.trigger('to.owl.carousel', [0, 100, true]);
      }, 100);
    }


  }

});;
function handleEndVideo() {
  $('#slider-movies video').off('ended');
  $('#slider-movies .active video').on('ended',function(){
    var sMovies = $('#slider-movies');
    sMovies.owlCarousel();

    sMovies.trigger('next.owl.carousel');
  });
  percent = 0;
}

function setHeightSlider() {
 
  var newHeight = $(window).height() - 90,
      valueHeight = Math.round(($(window).width()/16)*9),
      top = (newHeight - valueHeight) / 2;

  if(newHeight > valueHeight) {
    newHeight = valueHeight;
    top = 0;
  }

  $('#featured-movies').height(newHeight);
  $('#featured-movies .video').css({
    'top': top,
    'height': valueHeight
  });
  $('#featured-movies video').height(valueHeight);

  setTimeout(function() {
    $('#sliderWrapper').height($(window).height() - $('header').height());
  }, 100);
  $('#prefooter').css('height', $(window).height() - 90 + "px");
  $('#prefooter .imgSlide, #slider-movies .textVideo, #slider-movies .video').width($(window).width());
}

$(document).ready(function() {

  if($('.home').length) {

    var time = 7;
   
    var $progressBarMovies,
        $barMovies, 
        sliderMovies, 
        isPause, 
        clock,
        percent;

    function progressBarMovies(){
      // build progress bar elements
      buildProgressBarMovies();
        
      // start counting
      startMovies();
    }

    function buildProgressBarMovies(){
      $progressBarMovies = $("<div>",{
        id:"progressBarMovies"
      });
      
      $barMovies = $("<div>",{
        id:"barMovies"
      });
      
      $progressBarMovies.append($barMovies).prependTo($("#slider-movies"));
    }

    function startMovies() {
      // reset timer
      percent = 0;
      isPause = false;
      time = $('#slider-movies .owl-item.active video')[0].duration;
      
      // run interval every 0.01 second
      clock = setInterval(intervalMovies, 10);
    };

    function intervalMovies() {
      if(isPause === false){
        percent = ($('#slider-movies .owl-item.active video')[0].currentTime / $('#slider-movies .owl-item.active video')[0].duration) * 100;
        
        $barMovies.css({
          height: percent+"%"
        });
      }
    }

    // Slider Movies
    // =========================

    function pauseVideo() {
      $('#slider-movies .active video')[0].pause();
    }

    function clearClock() {
      // clear interval
      clearTimeout(clock);
      $barMovies.css({
        height: 0
      });

      $('#slider-movies .video').css('position', 'absolute');

      $('#slider-movies .active video')[0].pause();

      var p = ($('#slider-movies .owl-item').height() / 2) - 100;

      setTimeout(function() {
        $('#slider-movies .active').prev().find('video').css({
          '-webkit-transform': 'translate3d(0px, ' + p + 'px, 0px)',
          '-moz-transform': 'translate3d(0px, ' + p + 'px, 0px)',
          '-o-transform': 'translate3d(' + p + 'px, 0px, 0px)',
          '-ms-transform': 'translateX(0px) translateY(' + p + 'px)',
          'transform': 'translate3d(0px, ' + p + 'px, 0px)',
          'transition': 'all 0.5s ease'
        });

        $('#slider-movies .active video').css({
          '-webkit-transform': 'translate3d(0px, 0px, 0px)',
          '-moz-transform': 'translate3d(0px, 0px, 0px)',
          '-o-transform': 'translate3d(0px, 0px, 0px)',
          '-ms-transform': 'translateX(0px) translateY(0px)',
          'transform': 'translate3d(0px, 0px, 0px)',
          'transition': 'all 0.7s ease'
        });

        $('#slider-movies .active').next().find('video').css({
          '-webkit-transform': 'translate3d(0px, ' + p + 'px, 0px)',
          '-moz-transform': 'translate3d(0px, ' + p + 'px, 0px)',
          '-o-transform': 'translate3d(' + p + 'px, 0px, 0px)',
          '-ms-transform': 'translateX(0px) translateY(' + p + 'px)',
          'transform': 'translate3d(0px, ' + p + 'px, 0px)',
          'transition': 'all 0.5s ease'
        });
      }, 50);
    }

    function playNewVideo() {
      $('#slider-movies .owl-item video').each(function() {
        $(this)[0].currentTime = 0;
      });
      $('#slider-movies .video').css('position', '');
      $('#slider-movies .active video')[0].play();
      handleEndVideo();

      // clear interval
      clearTimeout(clock);
        
      // start again
      startMovies();
    }

    $("#slider-movies").owlCarousel({
      items: 1,
      loop: true,
      nav: false,
      dots: true,
      smartSpeed: 500,
      onTranslate: clearClock,
      onTranslated: playNewVideo,
      onDrag: pauseVideo,
      onInitialized: progressBarMovies,
      animateOut: 'slideOutUp',
      animateIn: 'slideInUp',
      mouseDrag: false
    });

    setTimeout(function() {
      setHeightSlider();
    }, 50);

  }

});;
$(document).ready(function() {

  if($('.home').length || $('.webtv').length) {

    // Slider Videos
    // =========================

    function setActiveVideos() {
      $('#slider-videos .owl-item').removeClass('center');
      $('#slider-videos .owl-item.active').first().addClass('center');
      if($('#slider-videos .owl-item.center').index() >= $('#slider-videos .owl-item').length - 2) {
        $('#slider-videos .owl-item').last().addClass('center');
      }
    }

    var sliderVideos = $("#slider-videos").owlCarousel({
      nav: false,
      dots: false,
      smartSpeed: 1300,
      margin: 50,
      autoWidth: true,
      loop: false,
      responsive:{
        0:{
          items: 1
        },
        1675: {
          items: 2
        }
      },
      onInitialized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slider-videos .owl-stage').css({ 'margin-left': m });
        setActiveVideos();
      },
      onResized: function() {
        var m = ($(window).width() - $('.container').width()) / 2;
        $('#slider-videos .owl-stage').css({ 'margin-left': m });
      },
      onTranslated: function() {
        setActiveVideos();
      }
    });

    sliderVideos.owlCarousel();

    $('body').on('click', '#slider-videos .owl-item', function(e) {
      sliderVideos.trigger('to.owl.carousel', [$(this).index(), 500, true]);
    });
  }

});;
// Slideshow
// =========================

var slideshows = [];

function initSlideshows() {

  // create slider of thumbs
  var nbItems = $('.single-article').length != 0 ? 7 : 8;

  var sliderThumbs =$('.thumbnails').owlCarousel({
    nav: false,
    dots: false,
    smartSpeed: 500,
    margin: 10,
    dragEndSpeed: 900,
    items: nbItems
  });

  sliderThumbs.owlCarousel();

  $('body').on('click', '.slideshow .thumbnails .owl-item', function(e) {
    sliderThumbs.trigger('to.owl.carousel', [$(this).index(), 400, true]);
  });

  // on click on thumbnail, change main picture
  $('.thumbnails .owl-item').on('click', function(e) {
    e.preventDefault();

    $(this).parents('.slideshow').find('.thumb').removeClass('active');
    $(this).parents('.slideshow').find('.images .img').removeClass('active');

    var i = $(this).index(),
        cap = $(this).find('.thumb').data('caption');

    $(this).find('.thumb').addClass('active');
    $(this).parents('.slideshow').find('.caption').html(cap);
    $(this).parents('.slideshow-img').find('.images .img').eq(i).addClass('active');
  });

  // init slideshow
  if($('.slideshow').length) {

    var slideshow = $('.slideshow .images').Chocolat({
      imageSize: 'cover',
      fullScreen: false,
      loop: true
    }).data('chocolat');

    slideshows.push(slideshow);
  }

  if($('.all-photos').length) {
    var slideshow = $('#gridPhotos').Chocolat({
      imageSize: 'cover',
      fullScreen: false,
      imageSelector: '.item:not(.isotope-hidden) .chocolat-image'
    }).data('chocolat');

    slideshows.push(slideshow);
  }

}

// close slideshow on click
$('body').on('click', '.chocolat-close', function(e){

  $('.chocolat-img').css('transition', 'all 0.9s ease').addClass('close');

  $('.chocolat-bottom').css('opacity', 0);
  $('.chocolat-close').css('opacity', 0);

  setTimeout(function() {
    $('.chocolat-wrapper').removeClass('show');
    $('body').removeClass('fixed');

    if($('.slideshow').length) {
      $('html, body').animate({
        scrollTop: $(window.location.hash).parents('.slideshow').offset().top - 300
      }, 0);
    }

    setTimeout(function() {
      for(var i=0; i<slideshows.length; i++) {

          slideshows[i].api().close();
          slideshows[i].api().destroy();
          history.pushState("", document.title, window.location.pathname);

      }
    }, 1000);

    setTimeout(function() {
      slideshows = [];
      $('.chocolat-wrapper').remove();
      initSlideshows();
    }, 1400);
  }, 900);
});

// mouseover img : close thumbs
$('body').on('mouseover', '.chocolat-img', function(e){
  $('.chocolat-wrapper .thumbnails').removeClass('open');
  $('.chocolat-pagination').removeClass('active');
  $('.chocolat-content').removeClass('thumbsOpen');
});

// mouseover img : hide attribute title
$('body').on('mouseover', '.chocolat-image', function() {
  $(this).attr('data-title', $(this).attr('title'));
  $(this).removeAttr('title');
});

// mouseout img : reset attribute title
$('body').on('mouseout', '.chocolat-image', function() {
  $(this).attr('title', $(this).attr('data-title'));
});

// show thumbs
$('body').on('mouseover', '.chocolat-pagination', function() {
  $(this).addClass('active');
  $('.chocolat-wrapper .thumbnails').toggleClass('open');
  $('.chocolat-content').addClass('thumbsOpen');
});

$('body').on('mouseour', '.chocolat-pagination', function() {
  $(this).removeClass('active');
});

$('body').on('click', '.chocolat-bottom .share', function() {
  $('.chocolat-bottom .buttons').toggleClass('show');
});

// zoom
$('body').on('click', '.chocolat-image', function() {
  var $that = $(this);

  $('.chocolat-wrapper .chocolat-bottom').append('<div class="thumbnails"></div>');
  $('.chocolat-left, .chocolat-right').appendTo('.chocolat-bottom');
  $('.chocolat-left').html('<i class="icon icon_flecheGauche"></i>');
  $('.chocolat-right').html('<i class="icon icon_fleche-right"></i>');

  if($('.press-media').length || $('.downloading-press').length ){
    if($('.lock').length){
      $('<a href="#" class="share cadenas"><i class="icon icon_cadenas"></i></a>').insertBefore('.chocolat-wrapper .chocolat-left');
    }else{
      $('<a href="#" class="share download"><i class="icon icon_telecharger"></i></a>').insertBefore('.chocolat-wrapper .chocolat-left');
    }
  }else{
    $('<a href="#" class="share"><i class="icon icon_share"></i></a>').insertBefore('.chocolat-wrapper .chocolat-left');
  }
  $('<div class="buttons square"><a href="//www.facebook.com/sharer.php?u=html.festival-cannes-2016.com.ohwee.fr&t=le%20titre" onclick="javascript:window.open(this.href,\'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700\');return false;" rel="nofollow" class="button facebook ajax"><i class="icon icon_facebook"></i></a><a href="#" onclick="window.open(\'https://twitter.com/intent/tweet?text=Enrages%20Polar%20Hybride\',\'\',\'width=600,height=400\')" class="button twitter"><i class="icon icon_twitter"></i></a><a href="#" class="button link"><i class="icon icon_link"></i></a><a href="#" class="button email"><i class="icon icon_lettre"></i></a></div>').appendTo('.chocolat-bottom');
  $('<div class="zoomCursor"><i class="icon icon_loupePlus"></i></div>').appendTo('.chocolat-wrapper');
  $('<div class="credit">' + $that.data('credit') + '</div>').insertBefore('.chocolat-wrapper .share');

  linkPopinInit();

  setTimeout(function() {
    $('.chocolat-wrapper').addClass('show');
  }, 200);

  setTimeout(function() {
    $('.chocolat-wrapper .chocolat-img').css('transition', 'all 900ms cubic-bezier(0.165, 0.435, 0.000, 0.935)');
    // change url hash
    window.location.hash = $that.attr('id');
    $('body').addClass('fixed');
  }, 2500);

  $(this).parents('.slideshow').find('.thumbnails .thumb').each(function() {
    $('.chocolat-wrapper .thumbnails').append($(this).clone());
  });

  if($(this).parents('#gridPhotos').length) {
    $('#gridPhotos .item').each(function() {
      if($(this).css('display') != 'none') {
        $('.chocolat-wrapper .thumbnails').append('<div data-id="' + $(this).find('.chocolat-image').attr('id') + '" class="thumb"><img src="' + $(this).find('img').attr('src') + '" /></div>');
      }
    });
  }

  if ($('body').hasClass('mob')) {
    $('.chocolat-bottom').addClass('show');
  }


  $('.chocolat-wrapper .thumbnails').owlCarousel({
    nav: false,
    dots: false,
    smartSpeed: 500,
    margin: 0,
    responsive:{
      0:{
        items:5
      },
      1280: {
        items: 6
      },
      1600:{
        items:7
      },
      1800:{
        items:8
      },
      1920: {
        items: 9
      }
    }
  });
});

// on click on thumb from the list : change pic and update hash
$('body').on('click', '.chocolat-wrapper .thumb', function() {
  var j = $(this).parent().index();

  $('.chocolat-wrapper .thumb').removeClass('active');
  $(this).addClass('active');

  var slideshow = $('.slideshow .images').data('chocolat');
  for(var i=0; i<slideshows.length; i++) {
    slideshows[i].api().goto(j);
  }

  window.location.hash = $(this).data('id');
});

$(document).ready(function() {
  initSlideshows();

  // if url contains a hash : load pic
  if(window.location.hash) {

    if($(window.location.hash).length) {
      $(window.location.hash).trigger('click');

      $('.chocolat-wrapper .thumb').removeClass('active');
      $('.chocolat-wrapper .thumb[data-id="' + window.location.hash.substr(1) + '"]').addClass('active');
    }
  }
});

// update hash and active photo on nav click
$('body').on('click', '.chocolat-left', function(){
  var hash = window.location.hash;

  if(parseInt(hash.substr(6)) - 1 > 0) {
    window.location.hash = hash.substr(1, 5) + (parseInt(hash.substr(6)) - 1);

    $('.chocolat-wrapper .thumb').removeClass('active');
    $('.chocolat-wrapper .thumb[data-id="' + window.location.hash.substr(1) + '"]').addClass('active');
  }
});

// update hash and active photo on nav click
$('body').on('click', '.chocolat-right', function(){
  var hash = window.location.hash;

  if(parseInt(hash.substr(6)) + 1 > 0) {
    window.location.hash = hash.substr(1, 5) + (parseInt(hash.substr(6)) + 1);

    $('.chocolat-wrapper .thumb').removeClass('active');
    $('.chocolat-wrapper .thumb[data-id="' + window.location.hash.substr(1) + '"]').addClass('active');
  }
});

// cursor close
$('body').on('mouseout', '.chocolat-content', function(){
  $('.zoomCursor').addClass('hide');
  return false;
});

$('body').on('mouseenter', '.chocolat-content', function(){
  $('.zoomCursor').removeClass('hide');
  return false;
});

var timeoutCursor;



$('body').on('mousemove', '.chocolat-content', function(e){
  if ($('body').hasClass('mob')) return false;

  if($('.chocolat-zoomed').length){
    $('.zoomCursor .icon').removeClass('icon_loupePlus').addClass('icon_loupeMoins');
  }else{
    $('.zoomCursor .icon').removeClass('icon_loupeMoins').addClass('icon_loupePlus');
  }
  $('.zoomCursor').css('left', e.clientX + 10).css('top', e.clientY);
  $('.chocolat-bottom').addClass('show');



  clearTimeout(timeoutCursor);
  timeoutCursor = setTimeout(function() {
    $('.chocolat-bottom').removeClass('show');
    $('.chocolat-bottom .buttons').removeClass('show');
  }, 4000);
});
;
// selection of points for the graph
var posts = [],
    s = null;


function convertToPath(points){
  var path = 'M4,' + (GLOBALS.socialWall.heightGraph - points[0]);
  
  for (var i=0; i<points.length; i++){
    var x = i*80 + 4;
    var y = -points[i]+GLOBALS.socialWall.heightGraph;
    if (i===0){
      path += 'L'+x+','+y+' ';
    }
    else if (i===points.length-1){
      path += x+','+y;
    }
    else {
      path += x+','+y+',';
    }
  }
  return path;
}

function makePath(data){
  var pathString = convertToPath(data);
  var graphHeight = $('#graph').height();
  
  function getDefaultPath(){
    var defaultPathString = 'M4,'+ (graphHeight - 30) +' H';
  
    for (var i=0; i<data.length; i++) {
      if (i!==0){ 
        defaultPathString += i*80+4+' ';
      }
    }
    
    return defaultPathString;
  }
  
  var path = s.path(getDefaultPath()).attr({
    stroke: '#c8a461',
    strokeWidth: 1,
    fill: 'transparent'
  });

  
  
  path.animate({ path: pathString }, 2000, mina.easeInOutQuint);

  /* point radius */
  var radius = 2;
  
  /* iterate through points */
  setTimeout(function() {
    for (var i = 0, length = data.length; i < length; i++) {
      var xPos = i*80 + 4;
      var yPos = GLOBALS.socialWall.heightGraph - data[i];
      
      var circle = s.circle(xPos, yPos, radius);

      var circle2 = s.circle(xPos, yPos, 15);

      circle.attr({
        stroke: '#c8a461',
        strokeWidth: 2,
        fill: '#fff',
        opacity: 0
      });

      circle2.attr({
        strokeWidth: 2,
        opacity: 0,
        title: data[i]
      });

      circle.animate({opacity: 1}, 300);

      circle2.mouseover(function() {
        $('#tipGraph').text($(this)[0].attr('title'));
        $('#tipGraph').css({
          top: parseInt($(this)[0].attr('cy')) - 25 + "px",
          left: $('#hashtag').width() + parseInt($(this)[0].attr('cx') - 15) + "px"
        });
        $('#tipGraph').addClass('show');
      });

      if($('.mob').length) {
        var top =  parseInt(yPos) - 25;
        var left = $('#hashtag').width() + parseInt(xPos) - 15;
        $('#graph').append('<div id="tipGraph" class="show" style="top:' + top + 'px;left:' + left + 'px;">' + data[i] + '</div>');
      }

      circle2.mouseout(function() {
        $('#tipGraph').removeClass('show');
      });

    }

    var j = $('#graph ul li.active').index();
    $('#graph circle[stroke="#c8a461"]').eq(j).attr('r', 5).css('stroke-width', '3');
  }, 2000);

  graphRendered = true;
  
}

 function makeGrid(){
  
  var dataLength = GLOBALS.socialWall.points.length;
  var maxValue = GLOBALS.socialWall.heightGraph;
  var minValue = 35;

  s = Snap('#graphSVG');
  
  // Creates the vertical lines in the graph
  for (var i=0; i<dataLength; i++) {
    var x = 4 + i*80;
    var xLine = s.line(x, minValue, x, maxValue).attr({
      stroke: "#000",
      strokeWidth: 0.25,
      strokeDasharray: '1 5'
    });
  }
}

function displayGrid() {
  $('.post').not('.big.right').each(function(i) {
    var $p = $(this);
    setTimeout(function() {
      $p.find('.side').addClass('flip');
    }, i*50);
  });

  setTimeout(function() {
    $('.big.right').find('.side').addClass('flip');
  }, 800);

  displayed = true;

  // randomly display new posts
  var p = $('.post .side-2');

  for (var i = 0; i < posts.length; ++i)
  {
    setTimeout(function() {
      var r = Math.floor(Math.random() * p.length);
      var c = p.splice(r, 1)[0];

      var random = Math.floor(Math.random() * posts.length);
      var item = posts.splice(random, 1)[0];

      $(c).prev().addClass(item.type);
      $(c).parent().find('.side-2').addClass('overlay');
      $(c).parent().find('.side').removeClass('flip');
      $(c).parent().find('.side-1').css('z-index', '5');
      if(item.img) {
        $(c).prev().addClass('hasimg').css('background-image', 'url(' + item.img + ')');
      }
      $(c).prev().append(item.text);
    }, (i+1) * 5000);
  }
}

$(document).ready(function() {

  if($('.home').length) {

  // Social Wall
  // =========================

  // GRAPH SVG

  makeGrid();

  //instagram

  var url = "https://api.instagram.com/v1/tags/"+GLOBALS.api.instagram.hashtag+"/media/recent/?access_token="+GLOBALS.api.instagram.token;
    
  // load Instagram pictures and build array
  function loadInstagram(url, callback){

    $.ajax({
      type: "GET",
      dataType: "jsonp",
      cache: false,
      url: url ,
      success: function(data) {

        var count = 15; 
        for (var i = 0; i < count; i++) {
          if (typeof data.data[i] !== 'undefined' ) {
            posts.push({'type': 'instagram', 'img': data.data[i].images.low_resolution.url, 'date' : data.data[i].created_time, 'text': '<div class="txt"><div class="vCenter"><div class="vCenterKid"><p>' + data.data[i].caption.text.substr(0, 140).parseURL().parseUsername().parseHashtag() + '</p></div></div></div>', 'user': data.data[i].user.username});
          }
          if( i == count - 1) {
            callback();
          }
        }
      }
    });

  }

  // TWITTER
  // load Twitter posts and pictures and build array
  function loadTweets(callback) {
    var request = {
      q: GLOBALS.api.twitter.hashtag,
      count:  GLOBALS.api.twitter.count,
      api:  GLOBALS.api.twitter.uri
    };

    $.ajax({
      url: GLOBALS.api.twitter.url,
      type: 'POST',
      datatype: 'json',
      data: request,
      success: function(data, textStatus, xhr) {
        data = JSON.parse(data);
//        console.log(data);
        data = data.statuses;
        var img = '';

        for (var i = 0; i < data.length; i++) {
        
          img = '';
          url = 'http://twitter.com/' + data[i].user.screen_name + '/status/' + data[i].id_str;
          try {
            if (data[i].entities['media']) {
              img = data[i].entities['media'][0].media_url;
            }
          } catch (e) {
            // no media
          }
        
          posts.push({'type': 'twitter', 'text': '<div class="txt"><div class="vCenter"><div class="vCenterKid"><p>' + data[i].text.parseURL().parseUsername(true).parseHashtag(true) + '</p></div></div></div>', 'name': data[i].user.screen_name, 'img': img, 'url': url, 'date': data[i].created_at})

          if(i==data.length - 1) {
            callback();
          }
        }
       
      }   
    });
  }

  loadInstagram(url, function() {
    loadTweets(function() {

      // once all data is loaded, build html and display the grid
      var p = $('.post .side-2');
      for (var i = 0; i < 13; ++i)
      {
        var random = Math.floor(Math.random() * posts.length);
        var item = posts.splice(random, 1)[0];

        var r = Math.floor(Math.random() * p.length);
        var c = p.splice(r, 1)[0];

        $(c).addClass(item.type);
        $(c).find('.side').addClass('flip');
        if(item.img) {
          $(c).addClass('hasimg').css('background-image', 'url(' + item.img + ')');
        }
        $(c).append(item.text);
        $(c).append('<span class="ov"></span>');
      }

    });
  });

  }

});;
$(document).ready(function() {
  var cl = new CanvasLoader('siteLoader');
      cl.setColor('#ceb06e');
      cl.setDiameter(20);
      cl.setDensity(34);
      cl.setRange(0.8);
      cl.setSpeed(1);
      cl.setFPS(60);

  cl.show();
  var $loader = $('#siteLoader'),
      $main = $('#main'),
      $header = $('header');

  if(parseInt(sessionStorage.scrolltop) > 10) {
    $('#logo-wrapper, #logo img, #sticky-user, header #search, a.search').css('transition', 'none');
    $('#sticky-user').css('transition-delay', '0');
    $('p.stick').addClass('noTrans');
    $header.addClass('sticky');
    $('body').css('margin-top', '101px');

    $('html, body').animate({
      scrollTop: 10
    }, 0);
  }

  setTimeout(function() {
    $('#main, footer, #breadcrumb, .sub-nav-list').removeClass('loading');
    cl.hide();

    $('#logo-wrapper, #logo img, #sticky-user, header #search, a.search').css('transition', '');
    $('p.stick').removeClass('noTrans');
  }, 500);

  $('body').on('click', "a[target!='_blank']:not(.ajax)", function(e) {
    var href = $(this).attr('href');
    var isiPad = navigator.userAgent.match(/iPad/i) != null;

    if(!isiPad) {
      e.preventDefault();
    }

    if(href.indexOf('#') == -1) {

      if(!isiPad) {

        $('#main, footer, #breadcrumb, .sub-nav-list').addClass('loading');

        setTimeout(function() {
          cl.show();
          $loader.addClass('show');
        }, 1100);

        setTimeout(function() {
          $loader.removeClass('show');
        }, 1800);

        setTimeout(function() {
          var v = $(window).scrollTop();
          if((v == 0 && $header.hasClass('sticky')) || (v == 10 && $header.hasClass('sticky'))) {
            v = 11;
          }
          sessionStorage.setItem('scrolltop',v);
          window.location = href;
        }, 1900);
      }
    }

    if(!isiPad) {
      return false;
    }
  });

});
;
// Todo generate structure  la vole
// playlist  la vole

var play1, play2, play3;

var d = document,
    w = window,
    k = k || new Konsole('fdc.2016', true),
    timeout = 1000,
    thread,
    controlBar =
        '<div class="control-bar">\
            <div class="playstate">\
                <button class="play-btn play icon icon_play"></button>\
            </div>\
            <div class="time">\
                <p class="time-info">\
                    <span class="current-time">0:00</span> / <span class="duration-time">0:00</span>\
                </p>\
            </div>\
            <div class="progress">\
                <div class="progress-bar">\
                    <div class="buffer-bar"></div>\
                    <div class="current-bar"></div>\
                </div>\
            </div>\
            <div class="sound">\
                <button class="icon icon_son"></button>\
                <div class="sound-bar">\
                    <div class="sound-seek"></div>\
                </div>\
            </div>\
            <div class="fs">\
                <button class="icon icon_fullscreen"></button>\
            </div>\
        </div>',
    topBar =
        '<div class="top-bar">\
            <a href="#" class="channels"><i class="icon icon_playlist"></i></a>\
            <div class="info"></div>\
            <div class="buttons square">\
            <a href="//www.facebook.com/sharer.php?u=html.festival-cannes-2016.com.ohwee.fr&t=le%20titre" onclick="javascript:window.open(this.href,\'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700\');return false;" rel="nofollow" class="button facebook ajax"><i class="icon icon_facebook"></i></a>\
                <a href="#" onclick="window.open(\'https://twitter.com/intent/tweet?text=Enrages%20Polar%20Hybride\',\'\',\'width=600,height=400\')" class="button twitter"><i class="icon icon_twitter"></i></a>\
                <a href="#" class="button link"><i class="icon icon_link"></i></a>\
                <a href="#" class="button email"><i class="icon icon_lettre"></i></a>\
            </div>\
        </div>',
    slider =
        '<div class="channels-video">\
            <div class="slider-channels-video owl-carousel sliderDrag">\
            </div>\
        </div>',
    slide = 
        '<div class="channel video shadow-bottom">\
            <div class="image-wrapper">\
                <img src="" alt="" width="293" height="185">\
            </div>\
            <a class="linkVid" href="#"></a>\
            <div class="info">\
                <div class="picto"><i class="icon icon_playlist"></i></div>\
                    <div class="info-container">\
                        <div class="vCenter">\
                            <div class="vCenterKid">\
                            <a href="#" class="category"></a>\
                            <span></span>\
                            <p>Sils Maria</p>\
                        </div>\
                    </div>\
                </div>\
            </div>\
        </div>';

function playerInit(id, cls, havePlaylist, live) {
    cls          = cls || '.video-player';
    havePlaylist = havePlaylist || false;
    live         = live || false;
    var tmp;

    if (id) {
        var videoPlayer = jwplayer(id);
        if(!$(videoPlayer).data('loaded')) {
            player($("#"+id)[0], videoPlayer, cls, havePlaylist, live, function(vid){
                $(vid).data('loaded', true);
                tmp = vid;
            });
        }
        return tmp;
    } else {
        tmp = [];
        $(cls).each(function(i,v) {
            // k.log("",this);
            // k.log("",this.className);
            // k.log("",this.id);
            var videoPlayer  = jwplayer(this.id);
            if(!$(videoPlayer).data('loaded')) {
                player(this, videoPlayer, cls, havePlaylist, live, function(vid){
                    $(vid).data('loaded', true);
                    tmp[i] = vid;
                });
            } else {
                tmp[i] = videoPlayer;
            }
        });
        return tmp;
    }
};

function player(vid, playerInstance, cls, havePlaylist, live, callback) {
    var $container    = $("#"+vid.id).closest('.video-container');
    $container.append(controlBar);
    $(topBar).insertAfter($container.find('#'+vid.id));

    var $infoBar      = $container.find('.infos-bar'),
        $stateBtn     = $container.find('.play-btn'),
        $durationTime = $container.find('.duration-time'),
        $current      = $container.find('.current-time'),
        $progressBar  = $container.find('.progress-bar'),
        $fullscreen   = $container.find('.fs button'),
        $sound        = $container.find('.sound'),
        $topBar       = $container.find('.top-bar');

    $topBar.find('.info').append($infoBar.find('.info').html());
    $topBar.find('.buttons .facebook').attr('href', $container.data('facebook'));
    $topBar.find('.buttons .twitter').attr('href', $container.data('twitter'));
    $topBar.find('.buttons .link').attr('href', $container.data('link'));
    $topBar.find('.buttons .email').attr('href', $container.data('email'));

    function updateVolume(x, vol) {
        var volume = $sound.find('.sound-bar'),
            percentage;
        if (vol) {
            percentage = vol;
        } else {
            var position = x - volume.offset().left;
            percentage = 100 * position / volume.width();
        }

        if (percentage > 100) {
            percentage = 100;
        } else if (percentage < 0) {
            percentage = 0;
        }

        $sound.find('.sound-seek').css('width',percentage+'%');
        playerInstance.setVolume(percentage);
    };

    function updateMute() {
        if (playerInstance.getMute()) {
            playerInstance.setMute(false);
            $sound.find('.sound-seek').css('width',playerInstance.getVolume()+'%');
        } else {
            playerInstance.setMute(true);
            $sound.find('.sound-seek').css('width','0%');
        }
    }

    function externeControl() {
        $topBar.on('click', '.channels', function() {
            $container.find('.channels-video').toggleClass('active');
            $container.find('.jwplayer').toggleClass('overlay-channels');
        });
    }

    function mouseMoving(listen) {
        if(listen) {
            $container.on('mousemove', function(event) {
                k.log('mousemove');
                $container.removeClass('control-hide');
                clearTimeout(thread);
                thread = setTimeout(function() {
                    k.log('mouse stopped');
                    $container.addClass('control-hide');
                }, timeout);
            });
        } else {
            clearTimeout(thread);
            $container.off('mousemove');
            $container.removeClass('control-hide');
        }
    }

    function initChannel() {
        sliderChannelsVideo = $container.find(".slider-channels-video").owlCarousel({
          nav: false,
          dots: false,
          smartSpeed: 500,
          center: true,
          loop: false,
          margin: 80,
          autoWidth: true,
        });

        sliderChannelsVideo.owlCarousel();
        sliderChannelsVideo.on('click', '.linkVid', function() {
            k.log('', $(this).closest('.owl-item'));

            playerInstance.playlistItem($(this).closest('.owl-item').index());
            
            console.log($(this).closest('.channel.video'));
            var infos = $.parseJSON($(this).closest('.channel.video').data('json'));
            k.log('', infos);
            $topBar.find('.info .category').text(infos.category);
            $topBar.find('.info p').text(infos.name);
            
            $container.find('.channels-video').removeClass('active');
            $container.find('.jwplayer').removeClass('overlay-channels');
        });
    }

    playerInstance.setup({
        file: $container.data('file'),
        image: $container.data('image'), 
        primary: 'html5',
        aspectratio: '16:9',
        width: $(vid).parent('div').width(),
        height: $(vid).parent('div').height(),
        controls: false
    });

    if (havePlaylist) {
        var tempSlider = $(slider),
            playlist   = $.parseJSON($container.data('playlist'));
        $.each(playlist, function(i,p) {
            var tempSlide = $(slide);
            tempSlide.find('.image-wrapper img').attr('src',p.image);
            tempSlide.find('.info-container .category').text(p.category);
            tempSlide.find('.info-container p').text(p.name)
            tempSlide.data('json', JSON.stringify(p));
            tempSlider.find('.slider-channels-video').append(tempSlide);
        });
        tempSlider.insertAfter($topBar);
        initChannel();
        playerInstance.load(playlist);
    } else {
        $topBar.find('.channels').remove();
    }

    if (live) {
        $container.find('.time').addClass('hide');
        $container.find('.progress').addClass('hide');
        $topBar.find('.channels').remove();
    }


    playerInstance.on('ready', function() {
        this.setVolume(100)
        // initChannel();
        externeControl();
    }).on('play', function() {
        $container.removeClass('state-init').removeClass('state-complete');
        $container.find('.infos-bar .info, .infos-bar .picto').addClass('hide');
        $container.find('.channels-video').removeClass('active');
        $container.find('.jwplayer').removeClass('overlay-channels');
        $stateBtn.removeClass('icon_play').addClass('icon_pause');
        fullScreenApi.isFullScreen() ? mouseMoving(true) : mouseMoving(false);
    }).on('pause', function() {
        $stateBtn.removeClass('icon_pause').addClass('icon_play');
        mouseMoving(false);
    }).on('complete', function () {
        this.stop();
        $stateBtn.removeClass('icon_pause').addClass('icon_play');
        $container.addClass('state-complete');
        mouseMoving(false);
    }).on('firstFrame', function() {
        _duration = playerInstance.getDuration();
        duration_mins = Math.floor(_duration / 60);
        duration_secs = Math.floor(_duration - duration_mins * 60);
        $durationTime.html(duration_mins + ":" + duration_secs);
    }).on('bufferChange', function(e) {
        // k.log("buffer", e);
        var currentBuffer = e.bufferPercent;
        $progressBar.find('.buffer-bar').css('width', currentBuffer+'%');
    }).on('time', function(e) {
        // k.log("time progress", e);
        if (_duration == 0) {
            duration_mins = Math.floor(e.duration / 60);
            duration_secs = Math.floor(e.duration - duration_mins * 60);
            $durationTime.html(duration_mins + ":" + duration_secs);
            _duration = e.duration;
         }

        var currentTime = e.position,
            currentMins = Math.floor(currentTime / 60),
            currentSecs = Math.floor(currentTime - currentMins * 60),
            percent = (currentTime / e.duration) * 100;

        if (currentSecs < 10) {
            currentSecs = "0" + currentSecs;
        }

        $current.html(currentMins + ":" + currentSecs);
        $progressBar.find('.current-bar').css('width', percent+'%');
    }).on('fullScreen', function() {
        this.resize('100%','100%');
    });

    $stateBtn.on('click', function() {
        playerInstance.play();
    });

    $progressBar.on('click', function(e) {
        var ratio = e.offsetX / $progressBar.outerWidth(),
            duration = playerInstance.getDuration(),
            current = duration * ratio;
        playerInstance.seek(current);
    });

    $container.find('.video-player, .infos-bar .picto').on('click', function(e) {
        $container.find('.infos-bar .info, .infos-bar .picto').addClass('hide');
        $container.removeClass('state-init');
        playerInstance.play();
        // $(this).off('click');
    });

    $sound.on('click', '.sound-btn', function() {
        updateMute();
    });

    var volumeDrag = false;
    $sound.find('.sound-bar').on('mousedown', function(e) {
        volumeDrag = true;
        playerInstance.setMute(false);
        updateVolume(e.pageX);
    });

    $(document).on('mouseup', function(e) {
        if(volumeDrag) {
            volumeDrag = false;
            updateVolume(e.pageX);
        }
    }).on('mousemove', function(e) {
        if(volumeDrag) {
            updateVolume(e.pageX);
        }
    });

    if (fullScreenApi.supportsFullScreen) {
        $fullscreen[0].addEventListener('click', function() {
            if(!fullScreenApi.isFullScreen()) {
                fullScreenApi.requestFullScreen($container[0]);
                $fullscreen.removeClass('icon_fullscreen').addClass('icon_reverseFullScreen');
                playerInstance.resize('100%','100%');
                mouseMoving(true);
            } else {
                fullScreenApi.cancelFullScreen();
                $fullscreen.removeClass('icon_reverseFullScreen').addClass('icon_fullscreen');
                playerInstance.resize('100%','100%');
                mouseMoving(false);
            }
        }, true);
    }

    // return playerInstance;
    callback(playerInstance);
};

$(d).ready(function() {
    play1 = playerInit('video-player', false, true, false);
    // play1 = playerInit('video-player', false, $('#video-player').data('playlist'), false);
    // play2 = playerInit(false, '.video-player', true, false);
    // play3 = playerInit(false, 'video-live', false, true);
});
;
$(document).ready(function() {

// Webtv
// =========================

  if($('.webtv').length) {
    if($('.webtv-live').length) {
     // play live player on click
     $('#live .play').on('click', function(e) {
       e.preventDefault();
       $('#live').addClass('on');
       //$('#live .img').addClass('rePosition');
       $('#live').data('height', $('#live').height()).height($(window).height() - 91);


       $('body').css('padding-top', 0);
       setTimeout(function() {
          if(!$('header').hasClass('sticky')) {
          $('#main').css('padding-top', '91px');
          }

          $('header').addClass('sticky');
        }, 800);
     });

     setTimeout(function() {
      $('#live .textLive').css('top', $('header').height() + ($('#live').height() - $('#live .textLive').height()) / 2);
      }, 500);

     if($('header').hasClass('sticky')) {
      $('.webtv #live .img').css('top', '-10%');
     }

      // create slide for trailers

      function setActiveTrailers() {
        $('#slider-trailers .owl-item').removeClass('center');
        $('#slider-trailers .owl-item.active').first().addClass('center');
        if($('#slider-trailers .owl-item.center').index() >= $('#slider-trailers .owl-item').length - 2) {
          $('#slider-trailers .owl-item').last().addClass('center');
        }
      }

      var sliderTrailers = $("#slider-trailers").owlCarousel({
        nav: false,
        dots: false,
        smartSpeed: 500,
        fluidSpeed: 500,
        loop: false,
        margin: 50,
        autoWidth: true,
        dragEndSpeed: 600,
        responsive:{
          0:{
            items: 1
          },
          1675: {
            items: 2
          }
        },
        onInitialized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-trailers .owl-stage').css({ 'margin-left': m });
          setActiveTrailers();
        },
        onResized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-trailers .owl-stage').css({ 'margin-left': m });
        },
        onTranslated: function() {
          setActiveTrailers();
        }
      });

        sliderTrailers.owlCarousel();

        $('body').on('click', '#slider-trailers .owl-item', function(e) {
          sliderTrailers.trigger('to.owl.carousel', [$(this).index(), 400, true]);
        });
      }

    function setActiveTrailer() {
      $('#slider-trailer .owl-item').removeClass('center');
      $('#slider-trailer .owl-item.active').first().addClass('center');
    }

   // create slide for trailers
    var sliderTrailer = $("#slider-trailer").owlCarousel({
        nav: false,
        dots: false,
        smartSpeed: 500,
        fluidSpeed: 500,
        loop: false,
        margin: 50,
        autoWidth: true,
        dragEndSpeed: 600,
        responsive:{
          0:{
            items: 3
          },
          1675: {
            items: 4
          }
        },
        onInitialized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-trailer .owl-stage').css({ 'margin-left': m });
          setActiveTrailer();
        },
        onResized: function() {
          var m = ($(window).width() - $('.container').width()) / 2;
          $('#slider-trailer .owl-stage').css({ 'margin-left': m });
        },
        onTranslated: function() {
          setActiveTrailer();
        },
      });

      $('.owl-item ').on('click', function(e){
          var $this = $(this);
          $('.center').removeClass('center');
          $this.addClass('center');
      });


       sliderTrailer.owlCarousel();
      $('body').on('click', '#slider-trailer .owl-item', function(e) {
        sliderTrailer.trigger('to.owl.carousel', [$(this).index(), 400, true]);
      });

if($('.webtv-ba-video').length){

      $('.nav li').click(function(){
        if($(this).hasClass('active')){

        }else{
          $('.nav').find('.active').removeClass('active');
          $(this).addClass('active');

            if($(this).hasClass('infos-film-li')){
              $('.program-film').css({display:'none'});
              $('.infos-film').css({display:'block'});

            }else{
              $('.program-film').css({display:"block"});
              $('.infos-film').css({display:"none"});

            }
        }
      });
    }

    //ajax
    $('.webtv .sub-nav-list a').on('click',function(e){
      //:not(.active)
      e.preventDefault();

      if($(this).is(':not(.active)')) {
        var urlPath = $(this).attr('href');

//        $.get($(this).data('url'), function(data){
        $.get(urlPath, function(data){

          $( ".content-webtv" ).html( $(data).find('.content-webtv') );
          $('#live').html( $(data).find('#live') );
          history.pushState('',GLOBALS.texts.url.title, urlPath);
            $grid = $('#gridWebtv').imagesLoaded(function() {
              $grid.isotope({
                layoutMode: 'packery',
                itemSelector: '.item'
              });
            });
        });
        $('.webtv-ba .sub-nav-list').find('a.active').removeClass('active');
        $(this).addClass('active');
      }
    });

    $('.item').click(function(){
      var url = $(this).find('.vCenterKid a').attr('href');
      document.location.href = url ;
    });

  }

  if($('.webtv-ba').length){

         //Scroll
      $(window).on('scroll', function() {
        var s = $(window).scrollTop();
        var h = $("#main").height()-900;

      if(s > 270 ){
        $('.sub-nav-list').addClass('sticky');
        $(".sub-nav-list").css({position: "fixed",top:90,zIndex:4});
      } else if (s < 270){
        $(".sub-nav-list").css({position: "relative",top:0});
      }
      });
     }
});
;
  // 24. Evenement 
  //=============================
  if ($('.evenement').length) {

    var $container = $('#gridEvent'),
      $grid;

    $grid = $('#gridEvent').imagesLoaded(function () {
      // init Isotope after all images have loaded
      setGrid($grid, $('#gridEvent'), true);
      $grid.isotope({
        itemSelector: '.item',
        percentPosition: true,
        layoutMode: 'packery',
        packery: {
          columnWidth: '.grid-sizer'
        }
      });

      $grid.isotope('layout');
    });
    $('.read-more').on('click', function (e) {
      e.preventDefault();
	$(this).hide();
      $.ajax({
        type: "GET",
        dataType: "html",
        cache: false,
        url: GLOBALS.urls.eventUrl /* TODO DEV : context URL */,
        success: function (data) {
          var $data = $(data).find('.gridelement');
          var $container = $('#gridEvent'),
              $grid;
          $grid = $container.imagesLoaded(function () {
				setGrid($grid, $data, false);
          });
        }
      });
    });
  };
$(document).ready(function() {
  if($('.popin-mail').length){
    $('.button.email').on('click touchstart', function(e){
      e.preventDefault();
        $('.popin-mail').addClass('visible-popin');
        $("#main").addClass('overlay-popin');
    });
    $(document).on('click', function (e) {

      var $element= $(e.target);
      if($element.hasClass('visible-popin')){

      }else{
        var $isPopin = $element.closest('.visible-popin');
        var isButton = $element.hasClass('button');

        if($isPopin.length || isButton){

        }else{
            $('.popin-mail').removeClass('visible-popin');
            $("#main").removeClass('overlay-popin');
            $('footer').removeClass('overlay');

        }
      }
    });


  }

   if($('.popin-mail').length) {
    // check that fields are not empty
    $('.popin-mail input[type="text"], textarea').on('input', function() {
      var input = $(this);
      var is_name = input.val();
      if(is_name){
        input.removeClass("invalid").addClass("valid");
        $('.errors .' + input.attr('name')).remove();
      }
      else{
        input.removeClass("valid").addClass("invalid");
        $('.errors .' + input.attr('name')).remove();
        $('.errors ul').append('<li class="popin ' + input.attr('name') + '">' + input.data('error') + '</li>');
      }
      if($('.invalid').length) {
        $('.errors').addClass('show');
      } else {
        $('.errors').removeClass('show');
      }
    });

    $('body').on('click', '.selectOptions span', function() {
      var i = parseInt($(this).index()) + 1;
      $('select option').eq(i).prop('selected', 'selected');
      $('.select').removeClass('invalid');
    });

    // check valid email address
    $('.popin-mail input[type="email"]').on('input', function() {


      var input=$(this);
      var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
      var is_email=re.test(input.val());
      var is_email_name=input.val();
      if(!is_email_name){
        input.removeClass("valid").addClass("invalid");
        $('.errors .' + input.attr('name')).remove();
        $('.errors ul').append('<li class="popin ' + input.attr('name') + '">' + input.data('error') + GLOBALS.texts.popin.empty + '</li>');

      }else if(is_email){
        input.removeClass("invalid").addClass("valid");
        $('.errors .' + input.attr('name')).remove();

      }
      else{
        input.removeClass("valid").addClass("invalid");
        $('.errors .' + input.attr('name')).remove();
        $('.errors ul').append('<li class="popin ' + input.attr('name') + '">' + input.data('error') + GLOBALS.texts.popin.error +'</li>');
// TODO remove string //
      }

      if($('.invalid').length) {
        $('.errors').addClass('show');
      } else {
        $('.errors').removeClass('show');
      }
    });

    // on submit : check if there are errors in the form
    $('.popin-mail form').on('submit', function() {
      var empty = false;

      if($('select').val() == 'default') {
        $('.select').addClass('invalid');
      } else {
        $('.select').removeClass('invalid');
      }

      $('.popin-mail input[type="text"], .popin-mail input[type="email"], .popin-mail textarea').each(function() {
        if($(this).val() == '') empty = true;
      });

      if(empty) {
        $('.popin-mail input[type="email"], .popin-mail input[type="text"], textarea').trigger('input');
      }

      if($('.invalid').length || empty){
        return false;
      }else{
        // TODO envoie du mail //
        $('#form').remove();
        $('.info-popin').remove();
        $('.contain-popin').append('<div class="valid">'+GLOBALS.texts.popin.valid+'</div>');
        $('.popin-mail').css('height','31%');
        return false;
      }
    });
  }


});

  // cookie banner

  $('.cookie-accept').click(function () { //on click event
    days = 365; //number of days to keep the cookie
    myDate = new Date();
    myDate.setTime(myDate.getTime()+(days*24*60*60*1000));
    document.cookie = "comply_cookie = comply_yes; expires = " + myDate.toGMTString(); //creates the cookie: name|value|expiry
    $("#cookies-banner").slideUp("slow"); //jquery to slide it up
  });


  //LINK POPIN//
  function linkPopinInit(){
    if($('.share').length || $('.square').length ){

      console.log("11111");
      new Clipboard('.link');
      var link = document.location.href;

      $('.link').attr('data-clipboard-text',link);

      $('.link').on('click touchstart',function(e){
        e.preventDefault();

        console.log("222222");

        if($('.single-channel').length){
          $('.button.email').css('border-right','1px solid #2C2C2C');
        }
        if($('.all-audios').length){
          $('.button.email').css('border-right','1px solid #dfdfdf');
        }
        if(!$('#share-box').length){

          if($('.share').length){
            $('.share').append('<div id="share-box"><div class="bubble"><a href="#">'+ GLOBALS.texts.popin.copy +'</a></div></div>');
          }else{
            $('.square').append('<div id="share-box"><div class="bubble"><a href="#">'+ GLOBALS.texts.popin.copy +'</a></div></div>');
          }

          $('#share-box').animate({'opacity':'1'},400,function(){

             $('#share-box').addClass('show');
             setTimeout(function(){
                   $('#share-box .bubble').html('<a href="#">'+link+'</a>');
             }, 1000);
          });
        }else if($('#share-box').hasClass('show')){
          $('#share-box').removeClass('show');
          $('#share-box').remove();
        }
          setTimeout(function(){
                $('#share-box').animate({'opacity':0},200,function(){
                  $('#share-box').removeClass('show');
                  $('#share-box').remove();
                });
          }, 3000);
      });
    }

  }

  linkPopinInit();
;
// init parallax elements and push them into an array
var parallaxElements = [];
function initParallaxElements() {

  var $header = $('header');

  if($('.home').length) {
    // home prefooter
    parallaxElements.push({
      'el1': '#prefooter .owl-item.center .imgSlide img',
      'positionTop': $('#slider-prefooter').offset().top,
      'division': 2,
      'mov': 1
    });

    // slider home
    parallaxElements.push({
      'el1': '#slider .owl-item .img-container',
      'positionTop': $('#slider').offset().top - $header.height(),
      'division': 2,
      'mov': 4
    });

    // slider movies home
    parallaxElements.push({
      'el1': '#slider-movies .owl-item.active .video',
      'positionTop': $('#slider-movies').offset().top,
      'division': 8,
      'mov': 4
    });

  }

  // header webtv
  if($('.webtv-live').length) {
    parallaxElements.push({
      'el1': '#live .img',
      'positionTop': $('#live').offset().top - $header.height(),
      'division': 0.3,
      'mov': 3,
      'direction': true
    });
  }

  // header single movie page
  if($('.single-movie').length) {
    parallaxElements.push({
      'el1': '.main-image .img',
      'positionTop': $('.main-image').offset().top - $header.height(),
      'division': 6,
      'mov': 15
    });
  }
}

// update
function update(){
  var hW = $(window).height();
  for(var i=0; i<parallaxElements.length; i++) {
    if(scrollTarget > (parallaxElements[i].positionTop - hW) && scrollTarget < parallaxElements[i].positionTop + hW) {
      $(parallaxElements[i].el1).css('position', 'fixed');
      render(parallaxElements[i].el1, parallaxElements[i].positionTop, parallaxElements[i].division, parallaxElements[i].mov, parallaxElements[i].direction);
    } else {
      $(parallaxElements[i].el1).css('position', '');
    }
  }
  window.requestAnimFrame(update);
}

// vars for parallax
var scrollTarget = 0,
    scrollPos = 0,
    scrollEase = 0.1;
    scrollEaseLimit = 0.1;

function render(el1, start, division, mov, direction){
  var hW = $(window).height();
  // process only if value is not reached
  var sc = scrollTarget - start;

  if (sc !== scrollPos && scrollTarget > (start - hW * 2)){

    // limit easing

    if (Math.abs(scrollPos - sc) < scrollEaseLimit){
      scrollPos = sc;
    }

    // increment pos with easing

    scrollPos += (sc - scrollPos) * scrollEase;


    // translate Element 2 with pos / 2 (half speed)
    var newPos = scrollPos/division;
    if(direction) {
      newPos = -(scrollPos * division);
    }
    transform1 = 'translate3d(0px, ' + newPos + 'px, 0px)';

    $(el1).css({
      '-webkit-transform': transform1,
      '-moz-transform': transform1,
      '-o-transform': transform1,
      '-ms-transform': transform1,
      'transform': transform1
    });



    // translate Element 2 with pos (plain speed)

    // transform2 = 'translate3d(0px, ' + (scrollPos/mov) + 'px, 0px)';

    // el2.style.webkitTransform = transform2;
    // el2.style.MozTransform = transform2;
    // el2.style.msTransform = transform2;
    // el2.style.OTransform = transform2;
    // el2.style.transform = transform2;

  }
}


$(document).ready(function() {

  var hW = $(window).height();

  // Events on scroll
  // =========================
  var lastScrollTop = 0,
      $header = $('header'),
      $timeline = $('#timeline'),
      $navMovie = $('#nav-movie');

  $(window).on('scroll', function() {
    var s = $(this).scrollTop();
    scrollTarget = s;

    // STICKY HEADER
    if (s > lastScrollTop){
      if(($('#prehome-container').length == 0 && s > 30)) {
        $header.addClass('sticky');
        $('body').css('margin-top', '91px');
      }
    } else {
      if(($('#prehome-container').length == 0 && s < 30)) {
        $header.removeClass('sticky');
        $('body').css('margin-top', '0');
      }
    }

    // SLIDER MOVIES : play or pause video on scroll
    if($('#featured-movies').length) {
      if(s > $('#featured-movies').offset().top - $('#featured-movies').height() && s < $('#featured-movies').offset().top + $('#featured-movies').height()) {
        $('#featured-movies .active').find('video')[0].play();
        handleEndVideo();
      } else {
        $('#featured-movies .active').find('video')[0].pause();
      }
    }

    // Display social wall
    if($('#social-wall').length) {
      if(s > $('#social-wall').offset().top - ($(window).height()/2) && !displayed) {
        displayGrid();
      }
    }

    // Render the path of hashtag graph
    if($('#graph').length) {
      if(s > $('#graph').offset().top - ($(window).height()/2) && !graphRendered) {
        makePath(GLOBALS.socialWall.points);
      }
    }

    // STICKY column on search page
    if($('.searchpage').length) {
      var $colSearch = $('#colSearch');
      if(s > $('#results').offset().top - 85 && s < ($('#footerSearch').offset().top - $('#footerSearch').height() - $colSearch.height() + 155)) {
        $colSearch.removeClass('bottom').addClass('stick');
      } else {
        if(s >= ($('#footerSearch').offset().top - $('#footerSearch').height() - $colSearch.height() + 155)) {
          $colSearch.removeClass('stick').addClass('bottom');
        } else {
          $colSearch.removeClass('stick');
        }
      }
    }

    // STICKY Timeline on homepage on scroll
    if($('#news').length) {
      if(s > $('#news').offset().top + 70 && s < ($('.read-more').offset().top - $('.read-more').height() - $timeline.height() - 3)) {
        $timeline.removeClass('bottom').addClass('stick').css('left', $('.content-news').offset().left + $('.content-news').width() + 57);
      } else {
        if(s >= ($('.read-more').offset().top - $('.read-more').height() - $timeline.height() - 3)) {
          $timeline.addClass('bottom');
        } else {
          $timeline.removeClass('stick').css('left', 'auto');
        }
      }
    }

    // NAV for single article
    if($('.single-article').length) {
      if($('.same-day').length) {
        if(s >= $('.same-day').offset().top - $('.same-day').height() / 2 - 100) {
          $('a.nav').addClass('bottom');
        } else {
          $('a.nav').removeClass('bottom');
        }
      }
    }

    // NAV for single evenement
    if($('.single-evenement').length) {
      if(s >= $('.share').offset().top - 300) {
        $('a.nav').addClass('bottom');
      } else {
        $('a.nav').removeClass('bottom');
      }
    }

    // PRESS
    // sticky calendar
    if($('.press-home').length || $('.press-programmation').length) {
      var $myCalendar = $('#calendar-wrapper');
      if(s > $('#calendar').offset().top - 91 && s < ($('.contact-press').offset().top - $myCalendar.height() - 91)) {
        $myCalendar.removeClass('bottom').addClass('stick').css('left', $('#calendar').offset().left);
      } else {
        if(s >= ($('.contact-press').offset().top - $myCalendar.height() - 91)) {
          $myCalendar.removeClass('stick').css('left', 'auto').addClass('bottom');
        }
        if(s <= ($('#calendar').offset().top - 91)) {
          $myCalendar.removeClass('stick').css('left', 'auto');
        }
      }
    }

    // WEBTV
    if($('.webtv-live').length) {
      var hght = $header.hasClass('sticky') ? 91 : 230;
      $('#live .textLive').css('top', hght + ($('#live').height() - $('#live .textLive').height()) / 2);
      $('.webtv #live .img').css('top', '');

      if(s > 50 && $('#live').hasClass('on')) {
        $('#live').removeClass('on');
        $('#live').height($('#live').data('height'));
        $('#main').css('padding-top', 0);
      }
    }

    // SINGLE MOVIE
    if($('.single-movie').length ) {
      // NAV
      if((s > ($('.videos').offset().top - $navMovie.height() - 100))) {
        $navMovie.addClass('sticky');
        if(s > $('div.press').offset().top + 1 - $navMovie.height()) {
          $navMovie.css('top', 0);
        } else {
          $navMovie.css('top', '91px');
        }
      } else {
        $navMovie.removeClass('sticky');
      }

      if(s > $('.competition').offset().top - ($(window).height() - $header.height() - 200)) {
        $('.nav').addClass('hide');
      } else {
        $('.nav').removeClass('hide');
      }

      if(s > 50 && s < $('div.press').offset().top - $('div.press').height()) {
        $('.nav, .prevmovie, .nextmovie').addClass('black');
      } else {
        $('.nav, .prevmovie, .nextmovie').removeClass('black');
      }

      if(s > 100 && $('.main-image').hasClass('trailer')) {
        $('.main-image').height($('.main-image').data('height')).css('padding-top', 0);
        $('.main-image, .poster, .info-film, .nav').removeClass('trailer');
      }

      var sections = $('*[data-section')
        , nav = $('#nav-movie')
        , nav_height = nav.outerHeight() + $header.height();

        sections.each(function() {
          var top = $(this).offset().top - nav_height,
              bottom = top + $(this).outerHeight();

          if (s >= top && s <= bottom) {
            nav.find('ul a').removeClass('active');

            nav.find('a[href="#'+$(this).data('section')+'"]').addClass('active');
          }
        });

    }

    lastScrollTop = s;

  });




  // ---------- PARALLAX ------------

  // on resize, update positionTop
  $(window).resize(function() {
    if($('.home').length) {
      // home prefooter
      parallaxElements[0].positionTop = $('#slider-prefooter').offset().top;
      parallaxElements[1].positionTop = $('#slider').offset().top - $header.height();
      parallaxElements[2].positionTop = $('#slider-movies').offset().top;
    }

    if($('.webtv-live').length) {
      parallaxElements[0].positionTop = $('#live').offset().top - $header.height();
    }

    hW = $(window).height();
  });

  setTimeout(function() {

    if($('#prehome-container').length == 0) {
      initParallaxElements();

      // launch RAF
      if(parallaxElements.length != 0) {
        update();
      }
    } else {
      setTimeout(function() {
        scrollTarget = 0;
        initParallaxElements();

        // launch RAF
        if(parallaxElements.length != 0) {
          update();
        }
      }, 3500);
    }

  }, 100);

//========== Scroll footer breadcrumb ==========/

    if($('#breadcrumb').length){
        $('#breadcrumb .goTop').on('click',function(){
          $('html, body').animate({
            scrollTop:0
          }, 'slow');
        });
    }


});
