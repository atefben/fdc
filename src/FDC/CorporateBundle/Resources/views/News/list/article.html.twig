{% trans_default_domain 'FDCCorporateBundle' %}
{% extends 'FDCCorporateBundle::layout.html.twig' %}
{% block bodyClass %}dark retrospective retrospective-home restrospective-init{% endblock %}

{% block body %}
    <section class=" border-bottom s-slider-retrospective">

        {% include 'FDCCorporateBundle:Retrospective:components/years_slider.html.twig' %}

    <div class="ajax-section"><div class="contain-ajax articles-list evenements padding-bottom" id="main">

    {{ render(controller('FDCCorporateBundle:Editions:menu', {year:app.request.get('year'), route:app.request.get('_route')})) }}

    {% include 'FDCCorporateBundle:News:components/filters.html.twig' %}

    <div class="grid-01 isotope-01">
        <div class="grid-sizer"></div>

        {% for article in articles %}
        <article class="card item article date-{{ article.publishedAt|date('d-m-y') }} {{ article.theme|trans_fallback('slug') }} all" data-format="article" data-theme="{{ article.theme|trans_fallback('slug') }}" data-time="1455909420" data-end="false">
            <div class="image">
                <div class="image-wrapper">
                    {% if article is news_article %}
                        {% set img = article.header %}
                        {% set trans = img.findTranslationByLocale(app.request.locale) %}
                        {% if trans is null or trans.file is null %}
                            {% set trans = img.findTranslationByLocale('fr') %}
                        {% endif %}
                        {% set file = trans.file %}
                        <img src="{% path file , '572x362' %}" srcset="{% path file , '572x362' %} 1x, {% path file , '1144x724' %} 2x" alt="{{ img|trans_fallback('alt') }} ">
                    {% elseif article is news_video %}
                        {% set header = article.header %}
                        {% if header is not null %}
                            {% set trans = header.findTranslationByLocale(app.request.locale) %}
                            {% if trans is not null and trans.file is not null %}
                                {% set imageTrans = trans %}
                            {% else %}
                                {% set trans = article.header.findTranslationByLocale('fr') %}
                                {% if trans is not null and trans.file is not null %}
                                    {% set imageTrans = trans %}
                                {% endif %}
                            {% endif %}
                            {% if imageTrans is defined and imageTrans is not null %}
                                {% set file = imageTrans.file %}
                                {% set img = header %}
                            {% endif %}
                        {% endif %}
                        {% if trans is defined and trans is not null %}
                            {% set img = article.video.image %}
                            {% if img is defined and img is not null %}
                                {% set trans = img.findTranslationByLocale(app.request.locale) %}
                                {% if trans is null or trans.file is null %}
                                    {% set trans = img.findTranslationByLocale('fr') %}
                                {% endif %}
                            {% endif %}
                            {% set file = trans.file %}
                        {% elseif article.video|trans_fallback('imageAmazonUrl') is not null %}
                            {% set imgamazon = s3_server_video ~ article.video|trans_fallback('imageAmazonUrl') %}
                        {% endif %}
                        {% if file is defined and file is not null %}
                            <img src="{% path file , '572x362' %}" srcset="{% path file , '572x362' %} 1x, {% path file , '1144x724' %} 2x" alt="{{ img|trans_fallback('alt') }} ">
                        {% elseif imgamazon is defined and imgamazon is not null %}
                            <img src="{{ imgamazon }}" alt="" />
                        {% endif %}
                    {% elseif article is news_audio %}
                        {% set header = article.header %}
                        {% if header is not null %}
                            {% set trans = header.findTranslationByLocale(app.request.locale) %}
                            {% if trans is not null and trans.file is not null %}
                                {% set imageTrans = trans %}
                            {% else %}
                                {% set trans = article.header.findTranslationByLocale('fr') %}
                                {% if trans is not null and trans.file is not null %}
                                    {% set imageTrans = trans %}
                                {% endif %}
                            {% endif %}
                            {% if imageTrans is defined and imageTrans is not null %}
                                {% set file = imageTrans.file %}
                                {% set img = article.header %}
                            {% endif %}
                        {% else %}
                            {% set img = article.audio.image %}
                            {% set trans = img.findTranslationByLocale(app.request.locale) %}
                            {% if trans is null or trans.file is null %}
                                {% set trans = img.findTranslationByLocale('fr') %}
                            {% endif %}
                            {% set file = trans.file %}
                        {% endif %}

                        <img src="{% path file , '572x362' %}" srcset="{% path file , '572x362' %} 1x, {% path file , '1144x724' %} 2x" alt="{{ img|trans_fallback('alt') }} ">
                    {% elseif article is news_image %}
                        {% set header = article.header %}
                        {% if header is not null %}
                            {% set trans = header.findTranslationByLocale(app.request.locale) %}
                            {% if trans is not null and trans.file is not null %}
                                {% set imageTrans = article.header.findTranslationByLocale(app.request.locale) %}
                            {% else %}
                                {% set trans = article.header.findTranslationByLocale('fr') %}
                                {% if trans is not null and trans.file is not null %}
                                    {% set imageTrans = trans %}
                                {% endif %}
                            {% endif %}
                            {% if imageTrans is defined and imageTrans is not null %}
                                {% set img = article.header %}
                                {% set file = imageTrans.file %}
                            {% endif %}
                        {% else %}
                            {% set img = article.gallery.medias[0].media %}
                            {% set trans = img.findTranslationByLocale(app.request.locale) %}
                            {% if trans is null or trans.file is null %}
                                {% set trans = img.findTranslationByLocale('fr') %}
                            {% endif %}
                            {% set file = trans.file %}
                        {% endif %}

                        <img src="{% path file , '572x362' %}" srcset="{% path file , '572x362' %} 1x, {% path file , '1144x724' %} 2x" alt="{{ img|trans_fallback('alt') }} ">
                    {% endif %}
                </div>
                <a href="{{ path('fdc_corporate_news_get', {'format': article.newsFormat, 'slug': article|trans_fallback('slug'), 'year': app.request.attributes.get('year') }) }}" class="linkImage"></a>
                <!--<a href="#" class="read-later"><i class="icon icon-read-latter"></i><span>Ajouter à ma sélection</span></a>-->
                <span class="picto"><i class="icon icon-photo"></i></span>
            </div>
            <div class="info">
                <a href="#" class="category">{{ article.theme|trans_fallback('name') }} </a><span class="date">{{ article.publishedAt|date('d.m.y') }}</span> . <span class="hour">{{ agenda_leftbar_translate_hour(article.publishedAt|date('H:i'), true, true) }}</span>
                <strong><a href="{{ path('fdc_corporate_news_get', {'format': article.translatable.newsFormat, 'slug': article|trans_fallback('slug'), 'year': app.request.attributes.get('year') }) }}">{{ article|trans_fallback('title')|truncate(40) }}</a></strong>
            </div>
        </article>
        {% endfor %}
    </div>

    </div></div>
</section>
    {% include "FDCCorporateBundle:Global:breadcrumb.html.twig" with {"breadcrumb": [
    {
    "name" : 'breadcrumb.69editions.home'|trans,
    "url"  : path('fdc_corporate_default_home')
    },
    {
    "name" : 'breadcrumb.retrospective.home'|trans,
    "url"  : path('fdc_corporate_editions_retrospective')
    },
    {
    "name" : app.request.attributes.get('year'),
    "url"  : path('fdc_corporate_editions_year', {'year': app.request.attributes.get('year')})
    },
    {
    "name" : 'header.mainnav.nav.lactualite'|trans,
    "url"  : ''
    },
    ]} %}
{% endblock %}