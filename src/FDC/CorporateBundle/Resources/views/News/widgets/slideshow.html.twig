{% trans_default_domain 'FDCCorporateBundle' %}

{% set hasPublishedMedias = false %}
{% for key, gallery in widget.gallery.medias if not hasPublishedMedias and gallery.media %}
    {% set trans = gallery.media.findTranslationByLocale(app.request.locale) %}
    {% if trans is null or trans.file is null %}
        {% set trans = gallery.media.findTranslationByLocale('fr') %}
    {% endif %}
    {% if gallery.media|is_published('site-institutionnel') %}
        {% set hasPublishedMedias = true %}
    {% endif %}
{% endfor %}

{% if hasPublishedMedias == true %}
    <div class="{% if class(widget) starts with 'StatementW' or class(widget) starts with 'InfoW' %}slideshow{% else %}slideshow{% endif %}">
        {% set file = "" %}
        <div class="slideshow-img">
            <div class="images">
                {% for key, gallery in widget.gallery.medias %}
                    {% if gallery.media %}
                        {% set trans = gallery.media.findTranslationByLocale(app.request.locale) %}
                        {% if trans is null or trans.file is null %}
                            {% set trans = gallery.media.findTranslationByLocale('fr') %}
                        {% endif %}
                        {% if gallery.media|is_published('site-institutionnel') %}
                            {% set file = trans.file %}
                            {% set copyright = gallery.media|trans_fallback('copyright') %}
                            <div class="img {% if loop.index0 == 0 %}active{% endif %}">
                                <a id="photo{{ gallery.media.id }}"
                                   data-pid="pid={{ gallery.media.id }}"
                                   data-date="{{ gallery.media.createdAt|date('d.m.y H:i') }}"
                                   data-label="{{ gallery.media.theme|trans_fallback('name') }}"
                                   title='{{ gallery.media|trans_fallback('legend')}}'
                                   class="chocolat-image ajax portrait"
                                   href="{% path file, '2560x1620' %}"
                                   data-credit="{% if copyright is not empty %}{{ 'slider.credit_image'|trans }} : {{ copyright }}{% endif %}"
                                   data-facebook="http://www.facebook.com/dialog/feed?app_id=1198653673492784&link=http://www.festival-cannes.com/fr/films/bacalaureat&picture=
http://cdn-media.festival-cannes.com/film_poster/0001/02/thumb_1458_film_poster_293x397.jpeg&name=BACALAUREAT%20-%20Festival%20de%20Cannes&caption=&description=Romeo%2C%20m%C3%A9decin%20dans%20une%20petite%20ville%20de%20Transylvanie%2C%20a%20tout%20mis%20en%20%C5%93uvre%20pour%20que%20sa%20fille%2C%20Eliza%2C%20soit%20accept%C3%A9e%20dans%20une%20universit%C3%A9%20anglaise.%20%0D%0AIl%20ne%20reste%20plus%20%C3%A0%20la%20jeune%20fille%2C%20tr%C3%A8s%20bonne%20%C3%A9l%C3%A8ve%2C%20qu%E2%80%99une%20formalit%C3%A9%20qui%20ne%20devrait%20pas%20poser%20de%20probl%C3%A8me%20%3A%20obtenir%20son%20baccalaur%C3%A9at.%20%0D%0AMais%20Eliza%20se%20fait%20agresser%20et%20le%20pr%C3%A9cieux%20s%C3%A9same%20semble%20brutalement%20hors%20de%20port%C3%A9e.%20Avec%20lui%2C%20c%E2%80%99est%20toute%20la%20vie%20de%20Romeo%20qui%20est%20remise%20en%20question%20quand%20il%20oublie%20alors%20tous%20les%20principes%20qu%E2%80%99il%20a%20inculqu%C3%A9s%20%C3%A0%20sa%20fille%2C%20entre%20%20compromis%20et%20compromissions%E2%80%A6&redirect_uri=http://www.festival-cannes.com/fr/sharing&display=popup"
                                   data-twitter="https://twitter.com/intent/tweet?text=BACALAUREAT%20http://www.festival-cannes.com/fr/films/bacalaureat"
                                   data-link="localhost:3000#102">
                                    <img src="{% path file, '1266x798' %}" alt="{{ gallery.media|trans_fallback('alt') }}" title="{{ gallery.media|trans_fallback('legend')  }}">
                                </a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
            {% set firstLegend = '' %}
            {% set firstCopyright = '' %}
            <div class="owl-carousel thumbnails">
                {% for key, gallery in widget.gallery.medias %}
                    {% if gallery.media %}
                        {% set trans = gallery.media.findTranslationByLocale(app.request.locale) %}
                        {% if trans is null or trans.file is null %}
                            {% set trans = gallery.media.findTranslationByLocale('fr') %}
                        {% endif %}
                        {% if gallery.media|is_published('site-institutionnel') %}
                            {% set photo = gallery.media %}
                            {% if loop.index == 1 %}
                                {% set firstLegend = photo|trans_fallback('legend') %}
                                {% set firstCopyright = photo|trans_fallback('copyright') %}
                            {% endif %}
                            {% set file = trans.file %}
                            {% set copyright = photo|trans_fallback('copyright') %}
                            <div data-id="photo{{ gallery.media.id }}" data-caption="<strong>{{ photo|trans_fallback('legend') }}</strong>{% if copyright is not empty %} © {% endif %}{{ copyright }}" class="thumb {% if loop.index0 == 0 %}active{% endif %}">
                                {% thumbnail file, '97x61' %}
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <p class="caption">
            <strong>{{ firstLegend }}</strong>
            {% if firstCopyright is not empty %} © {{ firstCopyright }}{% endif %}
        </p>

    </div>
{% endif %}